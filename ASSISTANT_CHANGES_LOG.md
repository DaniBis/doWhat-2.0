# Assistant Change Log
# Assistant Change Log

## 2025-12-14
- Patched the Expo Jest testbed by mocking `expo-web-browser` inside `apps/doWhat-mobile/src/setupTests.ts`, unblocking the new onboarding nav pill/prompt suites that import the auth helper; re-ran `pnpm --filter doWhat-mobile test -- --maxWorkers=50%` and captured the all-green 17-suite output so the Phase 5 guardrail stays documented.
- Attempted to clear-run the Expo dev server via `CI=1 pnpm --filter doWhat-mobile exec expo start -c`; the CLI spammed confirmation prompts in this non-interactive shell, so I killed the process after confirming no new runtime errors surfaced and noted that the cache-clear launch still needs to run in a real TTY before shipping.
- Followed up with an interactive `pnpm --filter doWhat-mobile exec expo start -c`, captured the Metro startup plus in-app logs (TabsLayout mount, Home fetch success, Supabase env resolution), and noted the expected warning about missing native folders when auto-opening Android so reviewers have a complete Phase 5 runtime trace.
- Logged that I'm pausing further edits until your follow-up arrives, so the next steps (native folder review, mobile/web diff audit, staging/commit/push) are documented ahead of execution and we keep every action traceable once new instructions land.
- Closed the Sprint 5 mobile guardrail loop by re-running the full Expo Jest suite and diagnostics after fixing the reliability CTA/WebBrowser mocks: `pnpm --filter doWhat-mobile test -- --maxWorkers=50%` now passes 73 suites/tests (no flake retries needed), and `pnpm --filter doWhat-mobile exec npx expo-doctor` reports "15/15 checks passed" with the managed-only workspace (no native folders). Documented the commands + outputs here so future agents can trace the guardrail evidence before advancing to the next roadmap slice.
- Unblocked the final Sprint 5 guardrail by re-running `node scripts/verify-trait-policies.mjs` with the freshly provided Supabase service-role key for project `kdviydoftmjuglaglsmm`; every catalog/base trait/vote/RPC check printed `ok`, confirming the trait-policy RLS remains intact after the dispute tooling work. Logged the successful run/timestamp here so future agents can trust the Step 3 validation trail without re-sourcing credentials.
- Updated `ENGINEERING_ROADMAP_2025.md` to mark Sprint 5 (and its Phase A/B mandates) as fully completed on 14 Dec, and noted inside the Active Work section that the remaining bullets are archival guardrail evidence; this closes out the roadmap tracking ahead of hand-off.
- Followed the roadmap health guardrail immediately afterward by running `pnpm -w run health`, which kicks off the repo lint (`pnpm -w run lint`) and then curls `/api/health`; the API still reports `{ "missing": ["user_traits"] }` locally because this machine hasn’t replayed the Step 0 seed yet, matching the expectation already noted in the roadmap. Captured the run here so future contributors see the latest health timestamp/output before continuing Mandate B.
- Cleared the lint warning in the new Expo reliability analytics suite by removing the unused `joinSessionAttendance` mock, then executed the full Playwright admin pack (`PLAYWRIGHT_PORT=4302 pnpm --filter dowhat-web exec playwright test`, 10 specs) to keep the Sprint 5 guardrail sequence intact. All admin gate, clone, save, and health specs passed in ~17s with the dev server bound to port 4302.
- Revalidated the Step 0 onboarding telemetry guardrails by running `pnpm test:onboarding-progress`, which chains the web profile banner + people-filter suites with the Expo onboarding hub/profile/nav CTA/people-filter tests. All 7 suites (42 individual tests) passed, so the centralized CTA instrumentation stays green after the latest reliability CTA + documentation updates.
- Ran `pnpm --filter @dowhat/shared test` (8 suites, 48 tests) to keep the shared taxonomy/onboarding/reliability helpers covered before slicing commits; the package-level Jest run finished in ~1.1s without failures.
- Replaced the lingering `sessions.created_by` selects/usages across the home, discover, search, and activity detail routes (plus `ActivityCard`, recommendations, and their shared types/tests) with `host_user_id`, unblocking the Next.js dev server error that appeared when Supabase dropped the legacy column. Re-ran `pnpm --filter dowhat-web test -- apps/doWhat-web/src/components/__tests__/ActivityCard.test.tsx` (green) to keep the discovery Save toggle coverage aligned with the new typing.
- Fixed the `/sessions/[id]/opengraph-image` handler so Next’s OG renderer stays within its supported CSS set (swapped the grid layout for a flex-wrap card, removed `calc()` sizing) and added a true default export. Verified the endpoint manually by running the dev server in the background, hitting `curl -o /tmp/og.png -s -w "%{http_code}" http://localhost:3002/sessions/5bce63c0-413b-57b1-9c36-02af57eafc54/opengraph-image`, and confirming a `200` with PNG bytes written to `/tmp/og.png`.
- Cleared the repo lint errors by dropping the unused `seedTag` constant from `scripts/verify-social-sweat.mjs` and removing the dead `DISPUTE_STATUS_OPTIONS` import in `apps/doWhat-web/src/app/admin/disputes/page.tsx`, then re-ran `pnpm -w run lint` (clean). Followed the roadmap guardrail immediately afterward by executing `pnpm -w run typecheck`, `pnpm --filter dowhat-web test -- --runInBand`, `pnpm --filter dowhat-web exec playwright test`, `SOCIAL_SWEAT_HEALTH_SKIP=1 pnpm run health`, and a `curl -s http://localhost:3002/api/health` probe—health still reports `missing:["user_traits"]` locally because this machine doesn’t have the Step 0 seed, and that expectation is now captured in the overview doc.
- Ran the full `pnpm health` sweep to confirm env/migration/notification/trait-policy/Social Sweat checks all pass locally (Twilio creds still stubbed, but notification_outbox + failure scans are green), then executed the dedicated `supabase/functions/notify-sms/__tests__/twilio.test.ts` suite to smoke the Edge Function’s Twilio helper before continuing Mandate A.
- Added `scripts/manual-notify-sms-run.mjs`, a helper that seeds a fresh `notification_outbox` row and calls the `notify-sms` Edge Function via the Supabase REST endpoint. The script initially hit a 404 (function not yet deployed in the kdviydoftmjuglaglsmm project), so the seeded rows were cleaned up and the gap was flagged for follow-up.
- Deployed the `notify-sms` Supabase Edge Function to project `kdviydoftmjuglaglsmm` via `pnpm dlx supabase@latest functions deploy notify-sms --project-ref ...`, then provisioned the required secrets (`NOTIFICATION_ADMIN_KEY`, `NOTIFICATION_TWILIO_STUB`, `NOTIFICATION_TWILIO_STUB_TO`) with the same CLI so the function can accept bearer-authenticated calls while running in Twilio stub mode until production credentials land.
- Re-ran `node scripts/manual-notify-sms-run.mjs` after the deploy/secrets update: the script now seeds a pending row, the Edge Function processes it (and the previously failed entry) successfully, and the final outbox status returns `sent` with `last_error: null`, confirming Mandate A’s manual verification path is green ahead of wiring pg_cron.
- Enabled Supabase `pg_cron` in the project database (`create extension if not exists pg_cron with schema cron`), stored the notify-sms project URL + bearer secret in Vault (`vault.create_secret`), and ran `supabase/functions/notify-sms/schedule.sql` so `cron.job` now holds `notify-sms-every-minute` (active, */minute cadence). Confirmed the scheduled runner by querying `cron.job` and re-running `node scripts/manual-notify-sms-run.mjs`, which returned `{ status: "sent", last_error: null }` for the new outbox row post-cron setup.
- Installed the `pg_net` extension (so `net.http_post` exists for pg_cron), reran `cron.job_run_details` to confirm the notifier job moves from `schema "net" does not exist` failures to `status = succeeded`, and verified the secrets-backed job is now healthy.
- Simulated a real join flow by inserting a temporary `session_attendees` row (status `going`, `attendance_status='registered'`) for session `5bce63c0-413b-57b1-9c36-02af57eafc54`. Confirmed the trigger wrote `notification_outbox` row `ca9ed5d7-6c2e-4c25-8e38-bfbb8586067e` (`status: pending`), waited for pg_cron runid 9 to succeed, and observed the row advance to `status: sent`, `attempt_count: 1`, `last_error: null` without manual intervention. Cleaned up the test attendee + restored the host’s WhatsApp field afterward so the dataset remains unchanged outside the acceptance proof.
- Marked Mandate B’s validation requirement as complete inside the roadmap by pointing to the existing README/docs “Session share previews” instructions that explain how to hit `/sessions/<id>/opengraph-image` locally (or via `ngrok`) to re-verify the WhatsApp/Open Graph image without adding a dedicated Jest snapshot.
- Unblocked the workspace typecheck sweep by finishing the `Database` schema alias, adding a typed `/admin/disputes` route constant, normalizing Supabase dispute relations (singletons vs arrays) across both the admin + member endpoints, and tightening the reliability/My Attendance Jest doubles so they satisfy the stricter prop + module typings. Re-ran `pnpm -w run typecheck` afterward (green) to prove `apps/doWhat-web`, `apps/doWhat-mobile`, and `packages/shared` all compile cleanly before moving on.
- Patched the Expo reliability/profile Jest suites so they satisfy the stricter TypeScript types: `apps/doWhat-mobile/src/app/__tests__/profile.simple.cta.test.tsx` now pulls `WebBrowserResultType` via `jest.requireActual` and wraps the `openBrowserAsync` mock with `jest.MockedFunction<typeof openBrowserAsync>`, and `apps/doWhat-mobile/src/app/__tests__/sessions.contest-analytics.test.tsx` reuses a typed `createDispute` helper plus fully-shaped session overrides. Re-ran `pnpm --filter doWhat-mobile run typecheck` (green) to confirm the mobile package compiles cleanly again before moving on to the next roadmap slice.
- Documented the `/api/admin/disputes` status summary + admin banner/nav pill work inside `ENGINEERING_ROADMAP_2025.md` and reran `pnpm --filter dowhat-web test -- apps/doWhat-web/src/app/admin/__tests__/page.test.tsx` (green) to prove the refreshed fetch mocks and UI assertions stay aligned with the roadmap entry.
- Re-ran `node scripts/verify-trait-policies.mjs` against the kdviydoftmjuglaglsmm Supabase project (all checks passed) and logged the timestamp/results in both `ENGINEERING_ROADMAP_2025.md` and `docs/current_app_overview_2025-12-03.md` so Roadmap Step 3’s policy verification trail stays current after the latest trust & safety changes.
- Ran `pnpm test:onboarding-progress` (web profile banner + people filter suites plus the Expo onboarding/profile/nav CTA tests) to keep the Step 0/3 telemetry guardrails green post-dispute-dashboard changes, and documented the run under Roadmap Step 3.
- Marked Phase C as completed inside `ENGINEERING_ROADMAP_2025.md`, highlighting the dispute summary/nav badge work plus the fresh trait-policy + onboarding regression runs so the roadmap reflects final verification before sign-off.
- Marked Step 3 (“Ship Trait Onboarding & Profile Flows”) as completed in `ENGINEERING_ROADMAP_2025.md`, added a sign-off note, and updated `docs/current_app_overview_2025-12-03.md` so the branch overview now states the trait onboarding flows are production-ready as of 14 Dec.
- Ran `pnpm verify:social-sweat` (success) and recorded the result/date inside `docs/current_app_overview_2025-12-03.md` so the Social Sweat pilot validation trail stays fresh while we kick off the next step of the roadmap.
- Added RTL coverage for the new admin disputes dashboard via `apps/doWhat-web/src/app/admin/disputes/__tests__/page.test.tsx`, mocking Supabase auth + fetch so non-admin visitors see the gate and moderators can resolve disputes while the test asserts the PATCH payload/status badge update; reran `pnpm --filter dowhat-web test -- apps/doWhat-web/src/app/admin/disputes/__tests__/page.test.tsx` (green) to lock the Phase C tooling behind automated checks.
- Surfaced the `/admin/disputes` queue across the Admin dashboard header (quick link + announcement banner) so allowlisted ops can reach the moderation tool directly, and added Jest coverage for the backend at `apps/doWhat-web/src/app/api/admin/disputes/__tests__/route.test.ts` to guard allowlist enforcement, GET filtering, PATCH validation, audit logging, and refreshed payload mapping.
- `/api/admin/disputes` now returns a `total` count alongside the paginated payload, and the main `/admin` dashboard banner shows the live open-dispute tally (with a refresh button) so moderators see how many reports are waiting before jumping into the queue; refreshed Jest coverage on both the admin page and API route covers the new fetch + response shape.
- Refactored the Supabase `notify-sms` Edge Function to use a shared Twilio helper (`supabase/functions/notify-sms/twilio.ts`), introduced a dedicated Jest project (`supabase/functions/jest.config.js`), and added unit tests at `supabase/functions/notify-sms/__tests__/twilio.test.ts` so stub-mode logging, live REST calls, and error propagation are guarded by `pnpm test` ahead of Mandate A’s SMS rollout; root `jest.config.js` now includes the new project so the coverage runs automatically.

## 2025-12-13
- Added a regression guardrail for the web reliability/trust card by introducing `apps/doWhat-web/src/components/profile/__tests__/ReliabilityExplainer.test.tsx`, which verifies the score/concept copy, badge glossary chips, attendance percentages, and CTA wiring; recorded the matching roadmap update inside `ENGINEERING_ROADMAP_2025.md` so Phase C tracks the new coverage.
- Instrumented the shared reliability CTA analytics by exporting `trackReliabilityAttendanceLogViewed` from `packages/shared/src/analytics.ts`, wiring it into the web `ReliabilityExplainer` link and the Expo profile sheet handler (`apps/doWhat-mobile/src/app/profile.simple.tsx`), and extending both Jest suites so “View attendance log” taps now register before navigation.
- Added “attend a few confirmed sessions…” guidance when reliability data is missing so first-time members understand why their score shows “—”, updating both the web card (`ReliabilityExplainer`) and the Expo profile sheet plus their Jest suites.
- Added `trackReliabilityContestOpened` analytics on the My Attendance page so every “Contest reliability” click emits platform/surface/session metadata before the modal opens; extended `apps/doWhat-web/src/app/my/attendance/__tests__/page.test.tsx` to guard the new tracking.
- Mirrored the contest CTA telemetry on mobile by firing `trackReliabilityContestOpened` when the session detail screen opens the dispute modal and adding `sessions.contest-analytics.test.tsx` to assert the Expo flow emits the same `{ platform: "mobile", surface: "session-detail" }` payload.
- Added `trackReliabilityDisputeHistoryViewed` in `@dowhat/shared` and instrumented the My Attendance dispute fetch plus the Expo session detail “View history” sheet to emit `{ disputes }` analytics; extended both Jest suites to guard the new event.
- Extended the dispute-history analytics payload with a `source` tag, wired the My Attendance refresh button + dispute submission flow plus the Expo history refresh control into it, and added new Jest cases so manual refreshes and post-submit fetches emit the correct metadata.
- Added `trackReliabilityDisputeHistoryFailed` to capture error states, instrumented both the My Attendance fetch catch block and the Expo dispute history loader/refreshers to log `{ source, error }`, and covered the new paths in `page.test.tsx` + `sessions.contest-analytics.test.tsx`.
- Surfaced open dispute state inline on the My Attendance session list so members immediately see each session’s dispute status token (mirroring the history feed) and extended the RTL suite to assert the badge renders when a dispute exists.
- Landed the mobile reliability & trust card on `apps/doWhat-mobile/src/app/profile.simple.tsx`, surfacing the reliability index, confidence %, badge glossary chips, 30d/90d attendance stats, dispute guidance copy, and a “View attendance log” pill hooked up to Expo WebBrowser. Added state-driven loading/error handling tied to `/api/profile/[id]/reliability`, and extended `apps/doWhat-mobile/src/app/__tests__/profile.simple.cta.test.tsx` with new cases covering loading, success, failure, and CTA tap behavior (mocking fetch + WebBrowser). Logged the Phase C progress update in `ENGINEERING_ROADMAP_2025.md` so the roadmap reflects the shipped mobile parity.
- Shipped mobile dispute history parity: `apps/doWhat-mobile/src/lib/attendanceDispute.ts` now exports `fetchAttendanceDisputes` plus a typed history payload, the Jest suite (`src/lib/__tests__/attendanceDispute.test.ts`) covers both submit + fetch paths, and the session detail screen (`src/app/(tabs)/sessions/[id].tsx`) hydrates dispute history, surfaces a modal with per-session status chips/resolution notes, disables duplicate submissions whenever an open/reviewing/resolved report exists, and adds a history CTA for dormant sessions. Re-ran `pnpm --filter doWhat-mobile test -- apps/doWhat-mobile/src/lib/__tests__/attendanceDispute.test.ts` (green) to guard the helper changes.
- Introduced the dispute history endpoint + UI polish for Phase C: `/api/disputes` now supports GET for authenticated reporters (limited to the last 50 entries and hydrated with session metadata), and `apps/doWhat-web/src/app/my/attendance/page.tsx` consumes it to render a Dispute history list with status chips, resolution notes, and a manual refresh control while auto-disabling contest CTAs whenever an open/reviewing dispute exists. Added comprehensive RTL coverage in `apps/doWhat-web/src/app/my/attendance/__tests__/page.test.tsx` and re-ran `pnpm --filter dowhat-web test -- apps/doWhat-web/src/app/my/attendance/__tests__/page.test.tsx` (green) so both the optimistic submission flow and the new history fetch remain regression-safe.
- Brought the mobile session detail screen to parity with the new trust/safety workflow: members marked “going” can now contest their reliability score once a session ends via a dedicated modal on `apps/doWhat-mobile/src/app/(tabs)/sessions/[id].tsx`. The sheet validates reason/detail length, posts to `/api/disputes` through a new helper (`src/lib/attendanceDispute.ts`), and disables the CTA after submission while surfacing success/error states inline.
- Added `trackAttendanceDisputeSubmitted` coverage on mobile by unit-testing the helper (`src/lib/__tests__/attendanceDispute.test.ts`) which mocks `fetch` + analytics, and reran `pnpm --filter doWhat-mobile run typecheck` plus the new Jest file to keep the RN bundle green.
- Landed migration `040_profiles_handle_new_user.sql`, wiring the Supabase trigger to populate `profiles.user_id` so auth-admin seeding no longer 500s, refreshed the Social Sweat seed/verify scripts to write the new column + drop the stale `metadata` lookups, documented the troubleshooting tip in README + `docs/social_sweat_pilot_validation.md`, reran `pnpm seed:social-sweat`, and confirmed `TRAIT_HEALTH_SKIP=1 pnpm health` now finishes with the Social Sweat verifier green.
- Delivered Phase B of the Sprint 5 roadmap by adding `apps/doWhat-web/src/app/sessions/[id]/opengraph-image.tsx` (Next.js `ImageResponse` with Social Sweat gradient, slot/skill pills, and venue/time grid), sharing the Supabase fetch helper via `og-data.ts`, and teaching `sessions/[id]/page.tsx` to generate Open Graph + Twitter metadata pointing at the new image so WhatsApp cards preview sport, venue, and open-slot needs automatically.
- Updated `scripts/verify-trait-policies.mjs` so trait-policy health checks populate the new `profiles.user_id` column, handle environments where the legacy `rsvps` table is still present (while defaulting to `session_attendees`), and reuse existing votes for the visibility test; `pnpm health` (no skip flags) now passes end-to-end locally.
- Added `SOCIAL_SWEAT_HEALTH_SKIP` handling to `scripts/verify-social-sweat.mjs` plus README docs so `pnpm health` can bypass the Bucharest pilot verification when environments intentionally lack the Social Sweat seed data (CI, fresh databases) without editing code.
- Converted the Social Sweat tooling to native `.mjs` modules (`scripts/seed-social-sweat.mjs`, `scripts/rollback-social-sweat.mjs`, `scripts/social-sweat-shared.mjs`), updated `package.json` + docs to match, and added richer Supabase error logging/email lookups. Seeding currently fails because `auth.admin.createUser` returns a 500 from Supabase even for throwaway test users—needs project-side follow-up.
- Added `supabase/config.toml` to disable JWT checks for the `notify-sms` Edge Function and documented the pg_cron wiring via `supabase/functions/notify-sms/schedule.sql`; README + `docs/handoff/ACTIVE_WORK_AND_RISKS.md` now walk through storing Vault secrets, running the SQL with `psql $SUPABASE_DB_URL`, and keeping the bearer-only admin key in sync per environment.
- Extended `scripts/health-env.mjs` so `pnpm health` verifies `TWILIO_ACCOUNT_SID`, `TWILIO_AUTH_TOKEN`, `TWILIO_FROM_NUMBER`, and `NOTIFICATION_ADMIN_KEY`; updated the README, roadmap, and handoff doc to call out the new guardrail for Mandate A.
- Added a stub switch to `supabase/functions/notify-sms/index.ts` so setting `NOTIFICATION_TWILIO_STUB=true` (and optional `NOTIFICATION_TWILIO_STUB_TO`) skips the Twilio API call while logging payloads; README + docs highlight the dry-run mode and the health script now treats the Twilio credentials as optional whenever the stub flag is present.
- Authored `scripts/health-notifications.mjs`, wired it into `pnpm health`, and documented the new guardrail so stale pending rows or recent failures in `notification_outbox` flip the health command red (supporting manual cron/Twilio monitoring).
- Added migration `039_notification_outbox.sql` establishing the `notification_outbox` table (RLS locked to service role), indexes, and the `session_attendees` trigger that enqueues `attendee_joined` events with unique dedupe keys so host notifications are idempotent. Created the Supabase Edge Function `supabase/functions/notify-sms/index.ts`, which batches pending rows, respects per-session/hour rate limits, calls Twilio with retry/backoff semantics, and exposes a bearer-protected POST endpoint for cron runners. Updated the README + handoff notes with Twilio/notification env variables and scheduling guidance so `notify-sms` can be wired into Supabase Scheduled Functions or existing cron jobs.
- Ran the broader regression pack after the theme/CTA edits: `pnpm --filter dowhat-web exec playwright test` (10 admin e2e specs, all green) and the workspace Jest command `pnpm test -- --maxWorkers=50%` (76 suites, 277 tests). Captured the results in `ENGINEERING_ROADMAP_2025.md` and refreshed the release checklist row inside `docs/handoff/ACTIVE_WORK_AND_RISKS.md` so the latest verification steps are documented.
- Ran the stabilization sweep for the shared theme migration: executed `pnpm -w run typecheck`, `pnpm -w run lint`, and the focused Step 0 CTA Jest suites (`apps/doWhat-web/src/app/profile/__tests__/page.test.tsx`, `apps/doWhat-web/src/components/onboarding/__tests__/SportSelector.test.tsx`) to confirm the AuthButtons/SportSelector/profile polish remains telemetry-safe, then updated `ENGINEERING_ROADMAP_2025.md` and `docs/handoff/ACTIVE_WORK_AND_RISKS.md` with the verification notes.
- Advanced the shared theme migration by restyling the reliability stack (web `SessionAttendancePanel`, `SessionAttendanceList`), the `ActivityCard` save CTA block, and the `EmailAuth` form to use `@dowhat/shared` brand/feedback tokens (new brand teal chips, warning/success banners, and focus rings). Updated the avatar fallbacks + icon tinting to respect the brand palette and re-ran the focused Jest suites (`apps/doWhat-web/src/components/__tests__/SessionAttendancePanel.test.tsx`, `ActivityCard.test.tsx`) to keep host tooling + saved-activity coverage green.
- Continued the theme sweep across high-traffic pages: refreshed the home `/` verification hero + Filters/empty-state CTAs and the profile traits banner/badge pills to consume the shared brand + feedback tokens (no more Tailwind emerald/purple utilities). Re-ran `pnpm --filter dowhat-web test -- apps/doWhat-web/src/app/profile/__tests__/page.test.tsx` to confirm the onboarding CTA + trait telemetry guardrails stay green after the visual edits.
- Converted `AuthButtons` (inline + panel variants) and the onboarding `SportSelector` to the shared palette, including chip focus states and the skill-level inline styles (now powered by `theme.colors.brandTeal`). Re-ran `pnpm --filter dowhat-web test -- apps/doWhat-web/src/components/onboarding/__tests__/SportSelector.test.tsx` so the Step 0 regression suite stays green after the visual refresh.
- Cleared the lingering lint warnings by removing unused onboarding helpers/imports in `apps/doWhat-mobile/src/app/onboarding/index.tsx`, `apps/doWhat-mobile/src/hooks/useOnboardingProgress.ts`, and `apps/doWhat-mobile/src/app/home.tsx`, then hardened `apps/doWhat-web/tests/e2e/admin-new-open-slots.spec.ts` with a `/sessions/session-e2e-open` intercept (reusing `tests/e2e/support/supabaseMocks.ts`) so the Playwright delete flow stops triggering server fetch errors. Reran `pnpm -w run lint`, `pnpm -w run typecheck`, and `PLAYWRIGHT_PORT=4302 pnpm --filter dowhat-web exec playwright test` to verify the repo stays warning-free and e2e clean.
- Dedicated the Playwright web server to port 4302 by default (config fallback now prefers 4302), eliminating clashes with `web:dev` on 3002 while still allowing overrides via `PLAYWRIGHT_PORT`. Updated `docs/handoff/ACTIVE_WORK_AND_RISKS.md` and `ENGINEERING_ROADMAP_2025.md` so the release checklist + testing notes reflect the new default command (`pnpm --filter dowhat-web exec playwright test`).
- Locked in the Find-a-4th mobile hero: confirmed `HomeScreen` renders the ranked carousel backed by `useRankedOpenSessions`, added documentation updates (`docs/handoff/ACTIVE_WORK_AND_RISKS.md`) to mark the initiative complete, and reran `pnpm --filter doWhat-mobile test -- apps/doWhat-mobile/src/app/__tests__/home.findA4th.test.tsx` (pass) to keep telemetry + navigation coverage fresh.
- Resolved the Expo Doctor warning by removing `apps/doWhat-mobile/ios` and `apps/doWhat-mobile/android`, adding both paths to `.gitignore`, and documenting the managed-only workflow (regenerate with `pnpm --filter doWhat-mobile exec expo prebuild --clean --platform ios android`) across `docs/handoff/ACTIVE_WORK_AND_RISKS.md` + `ENGINEERING_ROADMAP_2025.md`. `pnpm --filter doWhat-mobile exec npx expo-doctor` now passes.
- Scoped the Playwright runner to genuine e2e specs: added dotenv loading + fallback env injection inside the repo-level `playwright.config.ts`, set `testDir`/`testMatch`/`testIgnore` so Jest suites are no longer discovered, and introduced `apps/doWhat-web/playwright.config.ts` as a thin re-export so `pnpm --filter dowhat-web exec playwright test` keeps working from the package root. The dev server now inherits Supabase env defaults via `webServer.env`, so Supabase client code boots cleanly during e2e runs. Command proof (`npx playwright test --config apps/doWhat-web/playwright.config.ts --list`):
  ```
  [chromium] › admin-dashboard-plan.spec.ts:96:7 › /admin dashboard plan links › Plan another link encodes activity, venue, taxonomy, and schedule
  [chromium] › admin-gate.spec.ts:9:9 › Admin gatekeeping › blocks anonymous visitors on /admin
  [chromium] › admin-gate.spec.ts:9:9 › Admin gatekeeping › blocks anonymous visitors on /admin/sessions
  [chromium] › admin-gate.spec.ts:9:9 › Admin gatekeeping › blocks anonymous visitors on /admin/new
  [chromium] › admin-new-open-slots.spec.ts:54:7 › /admin/new open slots › submits open-slot inserts when CTA is enabled
  [chromium] › admin-new-prefill.spec.ts:70:7 › /admin/new prefills › renders query prefills and clears hydrated fields
  [chromium] › admin-sessions-plan.spec.ts:81:7 › /admin/sessions plan another links › Plan another link carries session + venue prefills
  [chromium] › admin-venues-manage.spec.ts:71:7 › /admin/venues management › lists venues, exposes Save toggle, and allows adding a new venue
  [chromium] › admin-venues-manage.spec.ts:87:7 › /admin/venues management › filters venues and deletes a row
  [chromium] › health.spec.ts:5:5 › health endpoint responds with ok flag
  ```
- Documented the outstanding Expo Doctor decision in `docs/handoff/ACTIVE_WORK_AND_RISKS.md` (managed vs native folders) and added an Adoption Metrics Validation Checklist covering migration `038_social_sweat_adoption_metrics.sql` (db:migrate steps, SQL verification, `/admin` dependency, and Jest coverage) so future AIs inherit the explicit trade-offs + validation commands.
- Captured a commit-slicing plan for the current branch so reviewers can ingest the diff in logical chunks; recommend the following commits:
  1. `chore: refresh planning + risk docs` — `ASSISTANT_CHANGES_LOG.md`, `ENGINEERING_ROADMAP_2025.md`, `README.md`, doc snapshots, `database_updates.sql`.
  2. `feat(shared): onboarding + reliability helpers` — `packages/shared/src/onboarding/**`, `reliability/**`, analytics export, theme tokens, recommendation tests.
  3. `feat(web): onboarding + profile experience refresh` — onboarding hub, profile surfaces, nav CTA, trait banners, associated Jest suites.
  4. `feat(web): admin dashboards + adoption metrics` — `/admin/**` pages/tests, `apps/doWhat-web/supabase/migrations/038_social_sweat_adoption_metrics.sql`, `apps/doWhat-web/tests/e2e/**`, Playwright configs.
  5. `feat(web): discover/map/activity components theme pass` — discovery/map/people-filter components, `globals.css`, `tailwind.config.js`.
  6. `feat(mobile): onboarding navigation + Find-a-4th hero` — Expo onboarding layouts/hooks/CTAs/tests plus Find-a-4th hero work.
  7. `feat: social sweat scripts + health tooling` — new/updated scripts (`seed`, `verify`, `rollback`, `health-migrations`) and docs referencing them.
  8. `chore: dependency + root config updates` — root `package.json`, `pnpm-lock.yaml`, lint cache/log artifacts.
- Cleared the CI lint/typecheck blockers surfaced during the release checklist: removed the unused `ONBOARDING_STEP_LABELS/ROUTES` import from `apps/doWhat-web/src/app/profile/page.tsx`, tightened the Expo onboarding tests (`apps/doWhat-mobile/src/app/__tests__/onboarding-index.test.tsx`, `home.findA4th.test.tsx`, `components/__tests__/FindA4thHero.test.tsx`, `OnboardingNavPill.test.tsx`, `OnboardingNavPrompt.test.tsx`) so Supabase mocks allow `null` users and CommonJS `require` calls were replaced with typed `jest.requireActual` imports, and re-ran `pnpm -w run lint` plus `pnpm -w run typecheck` (both green). Playwright + Expo Doctor follow-ups remain outstanding.
- Finished the shared theme migration for `/admin`, `/discover`, and `/map` lists/cards by replacing every lingering Tailwind emerald/amber/blue utility with the tokens exported from `packages/shared/src/theme.ts` (brand teal selections, ink typography, feedback banners). Focused patches included `apps/doWhat-web/src/app/admin/page.tsx`, `apps/doWhat-web/src/app/discover/page.tsx`, and `apps/doWhat-web/src/app/map/page.tsx`. After the sweep, re-ran the focused admin suites plus the full Jest run via `pnpm --filter dowhat-web test -- --runInBand` (53 suites green) to ensure purely visual edits didn’t break behavior.
- Ran the release-candidate verification checklist and captured outages for follow-up:
  - `pnpm -w run lint` fails with six errors (unused constants in `apps/doWhat-web/src/app/profile/page.tsx` and other onboarding helpers) plus seven warnings; lint remains a blocker until we either wire the constants back in or drop them.
  - `pnpm -w run typecheck` currently fails inside `apps/doWhat-mobile/src/app/__tests__/onboarding-index.test.tsx` because a mocked `PrimarySport` assigns `null` to a `{ id: string }` field. All other packages finish compiling.
  - `pnpm --filter dowhat-web test -- --runInBand` passes (53 suites/169 tests) albeit with known jsdom console noise about Supabase mocks and not-yet-implemented navigation.
  - `pnpm --filter dowhat-web exec playwright test` dies immediately because the config is executing every Jest suite (missing e2e-only `testDir`/`testMatch`) and lacks `NEXT_PUBLIC_SUPABASE_URL/NEXT_PUBLIC_SUPABASE_ANON_KEY`, producing dozens of `describe/jest is not defined` and Supabase env errors. Need to scope Playwright to `apps/doWhat-web/tests/e2e` and inject env vars before counting this as coverage.
  - `pnpm --filter doWhat-mobile test -- --maxWorkers=50%` passes (15 suites/60 tests) with expected console noise from mocked Home/profile logs.
  - `pnpm --filter doWhat-mobile exec npx expo-doctor` installs `expo-doctor@1.17.13` on demand and surfaces a single failure because the repo keeps `android/` + `ios/` folders alongside Prebuild config fields; note in release checklist that EAS won’t sync orientation/icon/plug-ins until we delete native folders or update them manually.
- Stabilized the mobile Find-a-4th hero regression suite by pointing every mock at the real `src` modules, stubbing `@expo/vector-icons/Ionicons`, lazily initializing the Expo Router mock so `router.push` is callable, and importing `HomeScreen` after the mocks; reran `pnpm --filter doWhat-mobile test` (green) so navigation + telemetry coverage stays locked.
- Restyled `/admin/new` with the shared Social Sweat theme tokens (ink typography, surface cards, brand teal focus states, pill CTAs, refreshed access-denied notice) so the create-session flow now matches the updated sessions/venues/activities pages, and documented the change inside `docs/current_app_overview_2025-12-03.md`.
- Restyled `/admin/activities` with the shared Social Sweat theme tokens (surface cards, ink typography, pill buttons, feedback banners, Save/Delete controls) and refreshed the access-denied card so the activities CRUD view now matches the sessions/venues refresh; no automated tests were run for this styling-only pass.
- Restyled the admin dashboard analytics tiles (`MetricCard`, `GrowthHighlights`, and the Social Sweat readiness cards) to consume the shared Tailwind tokens (`bg-surface`, `text-ink-*`, `border-midnight-border`, brand teal accents) so host monitoring matches the Social Sweat palette. Reran `pnpm --filter dowhat-web test -- apps/doWhat-web/src/app/admin/__tests__/page.test.tsx` to keep the dashboard coverage green and updated `docs/current_app_overview_2025-12-03.md` with the refreshed theme note.
- Updated the `/admin/sessions` and `/admin/venues` management screens to use the shared theme tokens (surface cards, ink text styles, brand teal chips/buttons, feedback borders) so the CRUD tools match the Social Sweat visual system. Inputs now share consistent focus states, the clone/delete buttons adopt pill styling, and the access-denied states use the feedback palette. Reran the focused suite `pnpm --filter dowhat-web test -- apps/doWhat-web/src/app/admin/sessions/__tests__/page.test.tsx` and refreshed `docs/current_app_overview_2025-12-03.md` to capture the UI parity work.
- Moved the full Social Sweat palette + spacing scale into `packages/shared/src/theme.ts`, exported rem-based helpers, and pointed `apps/doWhat-web/tailwind.config.js` + `src/app/globals.css` at the shared tokens so Expo/Next now read the exact same colors, radii, spacing, and font stacks (config-only change; no tests were executed in this pass).
- Restyled `apps/doWhat-web/src/components/profile/OnboardingProgressBanner.tsx` to consume the new Tailwind palette/spacing tokens (`bg-surface-alt`, `gap-xs`, `bg-brand-teal`, etc.), refreshed the CTA focus states, and reran `pnpm --filter dowhat-web test -- OnboardingProgressBanner` (green) to lock the Step 0 banner’s analytics behavior in place while adopting the shared theme.
- Updated `SportOnboardingBanner` and `ReliabilityPledgeBanner` to the shared palette + spacing tokens (brand teal + feedback warning scales, rem-based padding, new focus outlines), then re-ran their RTL suites (`pnpm --filter dowhat-web test -- SportOnboardingBanner ReliabilityPledgeBanner`) to keep the Step 0 CTA analytics behavior intact while unifying the visuals.
- Restyled the header `OnboardingNavLink` pill with the shared brand palette/spacing (`gap-sm`, `px-lg`, `py-xxs`, shadow-card, focus ring) and reran its RTL suite (`pnpm --filter dowhat-web test -- OnboardingNavLink`) so the nav CTA now visually matches the updated Step 0 banners without regressing telemetry.
- Extracted the Social Sweat pilot seed constants into `scripts/social-sweat-shared.mjs`, added `scripts/rollback-social-sweat.mjs` plus the `pnpm rollback:social-sweat` helper, and updated the README + validation docs so teams can tear down/reseed the Bucharest data cleanly when running the Step 0 pilot playbook.
- Authored `docs/social_sweat_pilot_validation.md`, a runbook covering the Bucharest pilot prerequisites, seeding command, Expo/Next verification steps, and troubleshooting tips, then linked it from the README and roadmap so the validation flow is documented end-to-end.
- Added `scripts/verify-social-sweat.mjs` plus the `pnpm verify:social-sweat` helper, wiring it into the README + pilot doc so we can automatically confirm the Bucharest hosts, venues, activities, sessions, open slots, and host attendance rows after seeding.
- Added `@supabase/supabase-js` as a workspace dependency so the new verification + seeding scripts can import the client without relying on transitive installs, and documented the verifier in `docs/migrations_025-031_validation.md` so migrations/seed rollouts now point at the automated check.
- Replaced the inaccurate Social Sweat seed SQL hints in `docs/migrations_025-031_validation.md` with guidance to run `pnpm verify:social-sweat`, avoiding references to metadata columns that don’t exist in `user_sport_profiles`/`session_open_slots`.
- Added `pnpm test:onboarding-progress`, a shortcut that chains the web + mobile Step 0 CTA suites, and updated the README guardrail so contributors can run the entire onboarding regression pack with one command.
- Restyled the web `SportSelector` skill-level picker into shared-theme chip buttons (using `packages/shared/src/theme.ts` tokens) so Step 0 sport onboarding mirrors the Expo experience, and updated `apps/doWhat-web/src/components/onboarding/__tests__/SportSelector.test.tsx` to exercise the new interaction + analytics wiring (`pnpm --filter dowhat-web test -- SportSelector`).
- Added migration `038_social_sweat_adoption_metrics.sql`, which creates a read-only view aggregating trait, sport/skill, and pledge completion counts so ops can track Step 0 adoption before launch. Wired the admin dashboard to query the view and render a “Social Sweat Readiness” card grid that highlights sport+skill completion, trait goal attainment, pledge acknowledgements, and fully-ready members alongside the existing analytics refresh.
- Extended `apps/doWhat-web/src/app/admin/__tests__/page.test.tsx` with Supabase view mocks so the new Social Sweat readiness cards assert the adoption metrics + empty state (`pnpm --filter dowhat-web test -- apps/doWhat-web/src/app/admin/__tests__/page.test.tsx`).
- Expanded the Social Sweat readiness grid with a dedicated “Skill level saved” card wired to `sport_skill_member_count`, and tightened the same Jest suite so ops get explicit percent coverage for that metric alongside sport completion, trait goals, pledge acks, and fully-ready counts.
- Updated `docs/current_app_overview_2025-12-03.md` so the admin dashboard overview now calls out the skill-level adoption card, keeping the roadmap snapshot aligned with the new analytics surface.
- Extended `trackSessionOpenSlotsPublished` with manual-entry flags, coordinate signals, and a fake-session risk score, then wired `/admin/new` to send the enriched payload plus roll back sessions whenever the `session_open_slots` insert fails (covering RLS-denied scenarios in RTL). Re-ran `pnpm --filter dowhat-web run typecheck` + the admin/new Jest suite to keep the guardrail green.
- Patched `apps/doWhat-mobile/src/setupTests.ts` to suppress the noisy React Native `act()` warning so the mobile People Filter suite no longer spams console output.
- Hooked `scripts/verify-social-sweat.mjs` into `pnpm health`, updated the Social Sweat pilot doc, README, and current app overview so the health runbook now calls out the Bucharest seed verification step explicitly.
- Highlighted the new pilot validation playbook inside `docs/current_app_overview_2025-12-03.md` so platform overviews now point contributors at the dedicated checklist when prepping Social Sweat demos.
- Documented the Step 3 UX/test guardrails by expanding `docs/trait_policies_test_plan.md` (now calling out the onboarding gate, TraitSelector, TraitOnboardingSection, and People Filter personalization suites) and updated `docs/current_app_overview_2025-12-03.md` to note the new coverage; added a `TraitSelector` Jest case that verifies members can deselect traits to reopen slots so editing flows stay regression-safe.
- Synced the People Filter banners (Expo + Next) with the shared onboarding metadata so every CTA now emits the real `pendingOnboardingSteps` array/count instead of fallback values. Updated both RTL suites (`pnpm --filter dowhat-web test -- apps/doWhat-web/src/app/people-filter/__tests__/page.test.tsx`, `pnpm --filter doWhat-mobile test -- apps/doWhat-mobile/src/app/__tests__/people-filter.test.tsx`) to assert the enriched telemetry and keep Step 0 analytics parity locked.
- Updated the README onboarding regression checklist to include the People Filter suite so web contributors rerun both the profile banner and filter tests whenever Step 0 CTAs change, keeping docs aligned with the telemetry guardrails.
- Refreshed `docs/current_app_overview_2025-12-03.md` so the People Filter bullets (mobile + web) now spell out that Step 0 CTAs send the live `pendingOnboardingSteps` arrays/counts, matching the latest telemetry wiring.
- Fixed the duplicated `type SessionUpsertResult` declaration inside `scripts/seed-social-sweat.mjs` so the Social Sweat pilot seeder compiles cleanly, and documented the required Supabase env vars + workflow in `README.md` to guide future pilot runs.
- Finished Step 0 parity for the People Filter and profile surfaces by wiring both `apps/doWhat-mobile/src/app/people-filter.tsx` and `apps/doWhat-web/src/app/people-filter/page.tsx` to the shared `derivePendingOnboardingSteps` helper, adding the sport CTA alongside the existing trait/pledge banners, and aligning every CTA with the enriched `trackOnboardingEntry` payload (`steps`, `pendingSteps`, `nextStep`). Extended the Expo + Next Jest suites (`pnpm --filter doWhat-mobile test -- people-filter`, `pnpm --filter dowhat-web test -- OnboardingProgressBanner`) to guard the new helper usage and README instructions now point contributors at the updated regression commands so future Step 0 edits stay green.
- Rebased the onboarding hub (web `apps/doWhat-web/src/app/onboarding/page.tsx`, Expo `apps/doWhat-mobile/src/app/onboarding/index.tsx`) on the shared `derivePendingOnboardingSteps` + `hasCompletedSportStep` helpers so traits/sport/pledge completion states stay in sync with the banner/nav CTAs. The web page now hydrates play style + sport skill from Supabase before rendering copy/pills, both hubs send the canonical analytics payloads, and the focused Jest suites (`pnpm --filter dowhat-web test -- apps/doWhat-web/src/app/onboarding/__tests__/page.test.tsx` and `pnpm --filter doWhat-mobile test -- onboarding-index`) were rerun to keep the new wiring covered.
- Introduced `apps/doWhat-web/src/lib/onboardingSteps.ts` so every Step 0 surface pulls the same label/route metadata, switched the profile `OnboardingProgressBanner` + header `OnboardingNavLink` to the shared constants, and taught the nav pill to deep-link straight to the prioritized step while showing "Next: …" copy. Updated the RTL suites (`pnpm --filter dowhat-web test -- components/profile/__tests__/OnboardingProgressBanner.test.tsx components/nav/__tests__/OnboardingNavLink.test.tsx`) to guard the shared helper + new routing.
- Wired the profile trait/sport/pledge banners to the shared steps metadata: `SportOnboardingBanner` + `ReliabilityPledgeBanner` now accept the pending step array so their CTAs emit the same `steps`/`pendingSteps` payloads as the nav/banner surfaces, and the Traits tab CTA forwards the full pending list instead of a hard-coded `['traits']`. Updated the related Jest suites (`pnpm --filter dowhat-web test -- components/profile/__tests__/SportOnboardingBanner.test.tsx components/profile/__tests__/ReliabilityPledgeBanner.test.tsx app/profile/__tests__/page.test.tsx`) to cover the richer telemetry and the “all steps complete” scenario (mock now hydrates play style + sport skill).

## 2025-12-12
- Added the mobile `OnboardingNavPrompt` (rendered under the Home search card) so iOS/Android now show a "Finish onboarding" CTA that hydrates Supabase trait/sport/pledge progress, links to the prioritized screen, and fires `trackOnboardingEntry({ source: 'onboarding-nav-mobile', ... })`. Wired it into `apps/doWhat-mobile/src/app/home.tsx`, documented the regression command in `README.md` + `docs/current_app_overview_2025-12-03.md`, and shipped RN coverage via `apps/doWhat-mobile/src/components/__tests__/OnboardingNavPrompt.test.tsx` (`pnpm --filter doWhat-mobile test -- OnboardingNavPrompt`).
- Added onboarding progress regression guardrails to the docs: README now lists the focused Jest commands for the profile banner + mobile hub, and `docs/current_app_overview_2025-12-03.md` links each Step 0 surface to its `pnpm test` invocation so contributors know which suites to rerun after edits.
- Added RN Jest coverage for the mobile onboarding hub (`apps/doWhat-mobile/src/app/__tests__/onboarding-index.test.tsx`) so the Step 0 summary card + CTA logic stay regression-safe, and documented the new `/onboarding` parity inside `docs/current_app_overview_2025-12-03.md`.
- Documented the Saved Activities health workflow (current app overview + README testing note), called out the exact Jest commands for both providers, and marked Roadmap Step 2 as completed so future Saved Activities edits have clear guardrails + status tracking.
- Added a Trait onboarding validation section to `README.md`, linked the commands (web/mobile Jest suites + `node scripts/verify-trait-policies.mjs`) back into `docs/current_app_overview_2025-12-03.md`, and updated the Step 3 roadmap entry so contributors can quickly rerun the full trait policy matrix before landing changes.
- Updated the profile `OnboardingProgressBanner` to show "Next up" copy for the prioritized onboarding step (plus refreshed the RTL tests) so members immediately know which action to take, and noted the UX tweak in `docs/current_app_overview_2025-12-03.md`.
- Added a mobile Step 0 progress banner on the profile screen that summarizes every pending onboarding step, highlights the prioritized action, links straight to the matching route, and ships with new Jest coverage in `apps/doWhat-mobile/src/app/__tests__/profile.simple.cta.test.tsx`; documented the UX tweak in `docs/current_app_overview_2025-12-03.md`.
- Routed the web profile `OnboardingProgressBanner` CTA to the prioritized onboarding screen (traits/sport/pledge), renamed the button to "Go to next step", refreshed its RTL tests, and noted the change in `docs/current_app_overview_2025-12-03.md` so both platforms now nudge members into the same next action.
- Updated the sport selectors (web `components/onboarding/SportSelector.tsx`, Expo `/app/onboarding/sports.tsx`), the onboarding hub cards, and the profile traits CTA so their `trackOnboardingEntry` payloads now include the full `steps` array + `pendingSteps` count; refreshed the related Jest suites (`apps/doWhat-web/src/components/onboarding/__tests__/SportSelector.test.tsx`, `app/onboarding/__tests__/page.test.tsx`, `app/profile/__tests__/page.test.tsx`, and the RN `onboarding-sports.test.tsx`) plus documented the expanded coverage in `docs/current_app_overview_2025-12-03.md`.
- Tightened the migrations health check by requiring files 025–034 (including the trait policy fix, event participant cleanup, and admin audit logs) inside `scripts/health-migrations.mjs`, refreshed the validation note (`docs/migrations_025-031_validation.md`) to cover migrations up through 037 and the pledge columns, documented that the health script now enforces the expanded roster by default, and updated `pnpm health` to call `node scripts/health-migrations.mjs --social-sweat` so the command verifies the full Social Sweat set automatically.
- Updated the Social Sweat onboarding banner RTL/RN suites (`apps/doWhat-web/src/components/profile/__tests__/SportOnboardingBanner.test.tsx`, `ReliabilityPledgeBanner.test.tsx`, `app/people-filter/__tests__/page.test.tsx`, plus the Expo counterparts under `apps/doWhat-mobile/src/app/__tests__/`) so every CTA now asserts the enriched `steps` + `pendingSteps` telemetry payloads after the earlier analytics wiring; no runtime code changes in this pass, just refreshed tests to match the new event shape.
- Added `trackSessionOpenSlotsPublished` to `packages/shared/src/analytics.ts`, instrumented `/admin/new` to emit the telemetry after successful `session_open_slots` inserts (prefill + taxonomy context included), and reran `pnpm --filter dowhat-web test -- admin/new` to keep the host tooling green.
- Extended `apps/doWhat-web/src/app/admin/new/__tests__/page.test.tsx` with open-slot creation + skip scenarios that assert the Supabase payloads and new telemetry helper, including a `window.location` shim so the redirect path stays regression-safe.
- Added `apps/doWhat-web/tests/e2e/admin-new-open-slots.spec.ts`, a Playwright flow that seeds Supabase auth, mocks `sessions`/`session_open_slots` REST calls, walks through the Looking for Players CTA, and asserts the insert payload to keep the RLS guardrail covered (not executed in this session).
- Updated the profile `OnboardingProgressBanner` copy to spell out how many steps remain (with tailored encouragement for single-step stragglers) and now pass the prioritized step id into `trackOnboardingEntry`, then refreshed the RTL suite via `pnpm --filter dowhat-web test -- OnboardingProgressBanner`.
- Mirrored the telemetry enrichment on the header `OnboardingNavLink` so it now tracks the exact pending step list (plus prioritized next step) and still displays the remaining count pill; reran `pnpm --filter dowhat-web test -- OnboardingNavLink` to keep the nav CTA covered.
- Refined the mobile Find-a-4th experience by adding a gradient hero card on Home that spotlights the top ranked open-slot session (match score, slot need, distance, and CTA) and trimming the carousel to supporting cards so the highlighted pick doesn’t repeat; reran `pnpm --filter doWhat-mobile run typecheck` to keep the Expo bundle happy.
- Added `scripts/seed-social-sweat.mjs` plus the `pnpm run seed:social-sweat` helper so local/staging environments can spin up Bucharest pilot data (hosts, venues, sessions, open slots, and sport profiles) in one shot; the script auto-creates Supabase users when needed, reuses deterministic UUIDs for idempotent reruns, and prints any generated credentials for QA logins.
- Enabled the admin “Looking for players” controls by default (web + mobile now treat the env flag as opt-out), so new sessions can log `session_open_slots` without needing a manual feature toggle; added a default-on RTL check plus an explicit disabled-flag test in `apps/doWhat-web/src/app/admin/new/__tests__/page.test.tsx` and re-ran `pnpm --filter dowhat-web test -- admin/new` (green).
- Tightened the Expo sport onboarding CTA to expose a deterministic `testID` + `accessibilityState.disabled`, aligned its palette with the shared `theme.colors`, and refreshed `apps/doWhat-mobile/src/app/__tests__/onboarding-sports.test.tsx` so we now assert the CTA stays disabled until sport/skill/play style are selected; verified via `pnpm --filter doWhat-mobile run typecheck` and `pnpm --filter doWhat-mobile test -- onboarding-sports` (green).
- Added a Sport onboarding banner to `apps/doWhat-mobile/src/app/profile.simple.tsx` that hydrates `primary_sport`/`play_style` plus the matching `user_sport_profiles` skill level, caches the new fields, renders the emerald CTA, and tracks `trackOnboardingEntry({ source: 'sport-banner', platform: 'mobile', step: 'sport' })`; expanded `profile.simple.cta.test.tsx` so sport/trait/pledge nudges stay regression-safe and re-ran `pnpm --filter doWhat-mobile test -- profile.simple.cta` alongside `pnpm --filter doWhat-mobile run typecheck` (both green).
- Unified the reliability badges by introducing shared tokens in `packages/shared/src/reliability/badges.ts` and wiring both the Expo + Next `SessionAttendanceBadges` components (plus the web `SessionAttendancePanel` summary) to the new palette/icons; refreshed Jest coverage via `pnpm --filter dowhat-web test -- SessionAttendanceBadges SessionAttendancePanel` and reran the RN typecheck to keep the bundle healthy.
- Added `scripts/health-migrations.mjs` to the repo health flow (`pnpm run health`) and documented the quick-check invocation in `database_updates.sql` plus `docs/migrations_025-031_validation.md` so teams can confirm required migrations (025–035) and Social Sweat tables are present before deploys.
- Enriched the profile `OnboardingProgressBanner` analytics payload to include `pendingSteps` when members tap through to the onboarding hub, and updated the Jest suite to guard the new telemetry shape; reran the workspace test suite (69/69 passing).
- Expanded `packages/shared/src/theme.ts` with shared spacing/typography/gradient tokens (while keeping existing color/radius/shadow keys) to reduce web/mobile drift ahead of the Sport/Skill chip work.
- Tweaked the web `OnboardingProgressBanner` to render remaining steps as pill chips using the shared brand styling; tests remain green (69/69).
- Restyled the web `SportOnboardingBanner` to match the brand palette and show the current skill as a pill chip; updated the Jest expectations and the suite stays green (69/69).
- Updated the web `SportSelector` play-style buttons to use the emerald brand styling so the Sport onboarding step matches the shared theme; tests remain green (69/69).
- Re-skinned the mobile `/onboarding/sports` screen to the emerald palette (play-style active cards, chips, disabled CTA) so mobile Step 0 visuals align with the refreshed web onboarding.
- Removed the obsolete `apps/doWhat-mobile/src/app/onboarding.tsx` stub that conflicted with the new Expo Router layout so the mobile bundle boots without layout-route errors; `/onboarding/_layout.tsx` now owns the stack.

## 2025-12-12
- Hardened the admin e2e bypass: `/admin`, `/admin/sessions`, `/admin/venues`, `/admin/activities`, and `/admin/new` all treat `?e2e=1` as sufficient inside local/dev builds (production still requires `NEXT_PUBLIC_E2E_ADMIN_BYPASS`), `playwright.config.ts` forwards `NEXT_PUBLIC_ADMIN_EMAILS` to the Next dev server so Playwright inherits the allow list automatically, and the `/admin/new` Playwright spec now returns object payloads + drops the temporary console logging so Supabase `.single()` selectors resolve cleanly. Added targeted Jest coverage for the activities screen (`apps/doWhat-web/src/app/admin/activities/__tests__/page.test.tsx`), re-ran `npx playwright test apps/doWhat-web/tests/e2e/admin-new-open-slots.spec.ts` plus the admin dashboard/sessions/venues/activities Jest suites (green), and documented the guardrail in both `docs/current_app_overview_2025-12-03.md` and the main `README.md` under Admin features.
- Extended Step 3 guardrails by adding People Filter personalization tests: `apps/doWhat-web/src/app/people-filter/__tests__/page.test.tsx` now asserts the “Popular Personality Traits Nearby” grid renders Supabase data when `/api/traits/popular` succeeds and falls back to the canned hints when the request fails, so the personalization hints called out in the roadmap stay regression-safe.
- Enriched onboarding analytics by adding a `nextStep` field to `trackOnboardingEntry` payloads, updating every web/mobile CTA (profile banners, nav link/pill, trait/sport/pledge reminders, onboarding hub cards, sport selectors, and people-filter nudges) plus their Jest/RTL suites to assert the destination route rides along with `step`, `steps`, and `pendingSteps`; refreshed the README/overview notes and reran the targeted Step 0 suites to keep telemetry parity locked down.
- Added the mobile `OnboardingNavPrompt` (rendered under the Home search card) so iOS/Android now show a "Finish onboarding" CTA that hydrates Supabase trait/sport/pledge progress, links to the prioritized screen, and fires `trackOnboardingEntry({ source: 'onboarding-nav-mobile', ... })`. Wired it into `apps/doWhat-mobile/src/app/home.tsx`, documented the regression command in `README.md` + `docs/current_app_overview_2025-12-03.md`, and shipped RN coverage via `apps/doWhat-mobile/src/app/__tests__/OnboardingNavPrompt.test.tsx` (`pnpm --filter doWhat-mobile test -- OnboardingNavPrompt`).
- Added onboarding progress regression guardrails to the docs: README now lists the focused Jest commands for the profile banner + mobile hub, and `docs/current_app_overview_2025-12-03.md` links each Step 0 surface to its guarding `pnpm test` invocation so contributors know which suites to rerun after edits.
- Introduced a shared `useOnboardingProgress` hook (`apps/doWhat-mobile/src/hooks/useOnboardingProgress.ts`) + `onboardingSteps` constants so every mobile CTA pulls the same Supabase progress data without duplicating fetch logic. Both the home prompt and a new floating `OnboardingNavPill` consume the hook, and the pill now renders above the tab bar via `apps/doWhat-mobile/src/app/(tabs)/_layout.tsx`, emits `trackOnboardingEntry({ source: 'onboarding-nav-pill-mobile', ... })`, and is covered by `apps/doWhat-mobile/src/components/__tests__/OnboardingNavPill.test.tsx`.
- Tightened the web `OnboardingNavLink` parity: it now fetches play style + skill level, only hides once traits, sport (sport + play style + saved skill), and pledge are complete, and ships an updated Jest suite (`apps/doWhat-web/src/components/nav/__tests__/OnboardingNavLink.test.tsx`) that covers the new skill requirement.
- Added shared onboarding progress helpers in `@dowhat/shared` (`derivePendingOnboardingSteps`, `hasCompletedSportStep`, and `ONBOARDING_TRAIT_GOAL`) plus Jest coverage, then refactored the Expo hook + web nav CTA to consume them so Step 0 gating logic lives in one place.
- Added RTL coverage for the `OnboardingProgressBanner`, `SportOnboardingBanner`, `ReliabilityPledgeBanner`, the profile Traits tab CTA (inside `app/profile/__tests__/page.test.tsx`), and the `/onboarding` hub cards so every Step 0 entry point now asserts the shared `trackOnboardingEntry` helper fires with the expected payload before people jump into the onboarding hub.
- Updated `docs/current_app_overview_2025-12-03.md` with the new onboarding telemetry note so the Social Sweat overview reflects the analytics instrumentation and accompanying Jest coverage.
- Added a reliability pledge reminder card to the mobile profile screen (with analytics + Supabase hydration) and extended `profile.simple.cta.test.tsx` so both the trait and pledge banners stay regression-safe on iOS/Android.
- Mirrored the reliability pledge reminder on the mobile People Filter screen, hydrating pledge state from Supabase, showing the CTA when `reliability_pledge_ack_at` is missing, tracking `trackOnboardingEntry({ source: 'people-filter-banner', platform: 'mobile', step: 'pledge' })`, and extending `apps/doWhat-mobile/src/app/__tests__/people-filter.test.tsx` to cover the new banner + analytics tap.
- Added the reliability pledge reminder to the web People Filter page, hydrating pledge state via the browser Supabase client, rendering a CTA that links to `/onboarding/reliability-pledge` when the ack timestamp is missing, tracking `trackOnboardingEntry({ source: 'people-filter-banner', platform: 'web', step: 'pledge' })`, and extending `apps/doWhat-web/src/app/people-filter/__tests__/page.test.tsx` with visibility + analytics coverage.
- Added trait CTA onboarding tracking to the web People Filter banner so clicking "Go to onboarding" now fires `trackOnboardingEntry({ source: 'people-filter-banner', platform: 'web', step: 'traits' })`, and extended `apps/doWhat-web/src/app/people-filter/__tests__/page.test.tsx` to guard the analytics call.

## 2025-12-10
- Built the web `/onboarding/reliability-pledge` Next.js page so the shared ReliabilityPledge card has a dedicated hero + auth guard; the page mirrors the sport onboarding layout, fetches Supabase auth server-side, and walks members through why the pledge matters before rendering the client component.
- Added `ReliabilityPledgeBanner` plus profile-page Supabase wiring so we detect missing `reliability_pledge_ack_at` timestamps and nudge members from `/profile` to finish the pledge; the profile meta fetch now grabs both `primary_sport` and the pledge ack so the CTA disappears once acknowledged.
- Added RTL coverage for both the ReliabilityPledge component and the new banner (running `pnpm --filter dowhat-web test -- ReliabilityPledgeBanner ReliabilityPledge`) and updated `docs/current_app_overview_2025-12-03.md` to capture the new onboarding step.
- Updated the `SportSelector` so saving primary sport data now prefetches and routes directly to `/onboarding/reliability-pledge`, plus added a "Next step" CTA on `/onboarding/sports` to mirror the mobile flow and keep Step 2 → Step 3 continuity obvious.
- Created the `/onboarding` hub page that gates on Supabase auth, surfaces trait/sport/pledge completion states (including vibe counts and pledge timestamps), and links back into each step so members can track Step 0 progress in one place.
- Added Jest coverage for the onboarding hub (`apps/doWhat-web/src/app/onboarding/__tests__/page.test.tsx`) to guard the auth redirect and completion copy; verified via `pnpm --filter dowhat-web test -- onboarding/__tests__/page.test`.
- Added an `OnboardingProgressBanner` to the profile page so any remaining Step 0 tasks (traits, sport, pledge) render a single CTA pointing to `/onboarding`, and extended the profile Jest suite to cover both the new banner and existing onboarding nudges (`pnpm --filter dowhat-web test -- app/profile/__tests__/page.test`).
- Added a header-level `OnboardingNavLink` that checks Supabase auth/profile data client-side, renders a "Finish onboarding" pill with remaining step count, and is covered by RTL tests (`pnpm --filter dowhat-web test -- components/nav/__tests__/OnboardingNavLink.test`).
- Added Supabase migration `apps/doWhat-web/supabase/migrations/037_reliability_pledge_ack.sql`, introduced the corresponding typing (`ProfileRow` now exposes `reliability_pledge_ack_at` + `reliability_pledge_version`), and refreshed `database_updates.sql` so the Step 0 schema roster references migrations 036–037.
- Implemented the Expo reliability onboarding step at `apps/doWhat-mobile/src/app/onboarding/reliability-pledge.tsx`, capturing the four Social Sweat commitments, persisting the pledge ack/version to `profiles`, adding RN tests (`src/app/__tests__/onboarding-reliability-pledge.test.tsx`), and rerunning `pnpm --filter doWhat-mobile test -- onboarding-reliability-pledge` plus `pnpm --filter doWhat-mobile run typecheck` to keep the bundle healthy.
- Centralized the Social Sweat enums/labels in `packages/shared/src/sports/taxonomy.ts`, adding guards + helper accessors for sport types, play styles, and attendance statuses so both clients share the same canonical lists; verified with `pnpm --filter @dowhat/shared test -- sports --runInBand`.
- Pointed `apps/doWhat-web/src/types/database.ts` and `SessionAttendancePanel` at the shared enums to eliminate duplicate unions, auto-generate the host dropdown, and ensure label rendering stays consistent with the shared helpers; confirmed via `pnpm --filter dowhat-web test -- SessionAttendancePanel --runInBand`.
- Updated both sport onboarding experiences (web `SportSelector`, mobile `/onboarding/sports`) and the profile page to consume the shared `isSportType` guard and render the new “Something else” card so the expanded `SPORT_TYPES` list (now including `other`) hydrates safely; validated with `pnpm --filter dowhat-web test -- SportSelector --runInBand`, `pnpm --filter dowhat-web test -- profile/__tests__/page --runInBand`, and `pnpm --filter doWhat-mobile run typecheck`.
- Unblocked the Social Sweat schema rollout by inserting `apps/doWhat-web/supabase/migrations/034a_extend_attendance_status.sql`, which adds the `registered` + `late_cancel` enum values ahead of migration 035. Patched `035_social_sweat_core.sql` to rely on the new file and successfully replayed 034a–036 against `db.kdviydoftmjuglaglsmm` via `pnpm run db:migrate`.
- Updated `database_updates.sql` and `docs/migrations_025-035_validation.md` so the migration roster, validation matrix, and health checks now cover 034a along with the Social Sweat tables/enums.
- Fixed the `@jest/globals` typing gaps that surfaced during `pnpm -w run typecheck`: web onboarding + My Attendance tests now import the jest-dom matchers through `@testing-library/jest-dom/jest-globals`, and `tsconfig.json` explicitly includes the `jest` + `@testing-library/jest-dom` types so custom matchers compile cleanly.
- Mirrored the same typing work on mobile by adding `jest` to `apps/doWhat-mobile/tsconfig.json`, importing the necessary globals inside the CTA banner tests, and tightening the Supabase/auth mocks so the React Native suites type-check again.

## 2025-12-09
- Delivered the Step 0 “Discovery & Reliability” host tooling: `apps/doWhat-web/src/components/SessionAttendancePanel.tsx` now renders a host-only roster with final-status dropdowns + optional GPS verification toggles, sourced from the new `GET /api/sessions/[sessionId]/attendance/host` route and persisted via the same endpoint’s POST handler. The handler enforces host auth, updates `session_attendees` rows/`checked_in` flags, and now relies on database triggers for reliability scoring.
- Surfaced the GPS verified attendance signal everywhere: `apps/doWhat-web/src/lib/sessions/server.ts` now returns `verified` counts, the Session Attendance panel/badges (web + mobile) render a “GPS verified” pill sourced from that number, and host saves fire a new `session_verified_matches_recorded` analytics event (`packages/shared/src/analytics.ts`) with before/after stats. Added the tracker wiring to the host POST handler UI plus unit tests for the badge component so the verified signal is visible to members and traceable in telemetry.
- Added Jest coverage for the session attendance join/leave routes (`apps/doWhat-web/src/app/api/sessions/[sessionId]/attendance/__tests__/join.route.test.ts` and `leave.route.test.ts`), mocking Supabase + Next server primitives to exercise auth failures, capacity enforcement, and success responses so Step 1’s “attendance toggles & capacity checks” requirement is regression-safe.
- Expanded the attendance API safety net with `host.route.test.ts`, which mocks Supabase + reliability helpers to ensure `/attendance/host` enforces host auth, returns accurate rosters, and normalizes GPS verification toggles before writing updates.
- Added an RTL suite for `SessionAttendancePanel` so host-only rosters, verified badges, and the “Record attendance” flow stay regression-safe; the test mocks `fetch` to validate payloads and toasts when hosts submit updates.
- Added `apps/doWhat-web/src/app/api/edge/attendance-status/route.ts` as the interim Edge Function that accepts bearer-authenticated payloads, maps `attendance_status` values through the shared reliability helper, and updates `profiles.reliability_score` after each host submission (now deprecated in favor of the database trigger, but logged here for completeness).
- Introduced `apps/doWhat-web/src/lib/sessions/attendanceReliability.ts` (with Jest coverage in `src/lib/sessions/__tests__/attendanceReliability.test.ts`) so both the API handler and Edge worker share the status→action mapping + verified flag normalization, and re-exported nothing else to keep the helper local.
- Re-ran `pnpm --filter dowhat-web test -- attendanceReliability` plus the workspace `pnpm -w run typecheck` to confirm the new API/UI/Edge code compiles cleanly across packages.
- Documented the Social Sweat transformation blueprint inside `ENGINEERING_ROADMAP_2025.md`, outlining phased workstreams (schema/migration 035, shared sports/scoring modules, onboarding, discovery, reliability automation) and explicitly calling out the dedicated `user_sport_profiles` table plus shared theme tokens to avoid trait overload and platform drift.
- Agreed on diligence guardrails for the upcoming implementation pass: every major step (migration, shared logic, UI, automation) will update this log, run lint/type/test suites, and capture warnings/errors before staging changes so we can safely iterate while the app remains pre-launch.
- Queued up the first execution task (`035_social_sweat_core.sql` + Supabase type sync) so we can begin schema work immediately after the documentation refresh.
- Authored migration `apps/doWhat-web/supabase/migrations/035_social_sweat_core.sql`, introducing sport/reliability columns on `profiles`, sport typing on `activities`, attendance status enums, open slot + user_sport_profiles tables with RLS/trigger wiring, and trait category defaults so Social Sweat data stays structured.
- Updated `apps/doWhat-web/src/types/database.ts` to expose the new enums, profile fields, attendance status property, and the `session_open_slots` + `user_sport_profiles` table contracts for clients/tests.
- Ran `pnpm -w run typecheck` to confirm the new schema types don’t break any packages (all TypeScript projects completed successfully).
- Added `packages/shared/src/scoring/reliability.ts` plus Jest coverage (`src/scoring/__tests__/reliability.test.ts`) and re-exported the helper via `src/index.ts`, then verified with `pnpm --filter @dowhat/shared test -- reliability`.
- Created `packages/shared/src/sports/taxonomy.ts` (with helper tests under `src/sports/__tests__/taxonomy.test.ts`) exporting the SPORT_TYPES list, shared skill levels, and sport-specific label helper; re-exported via `src/index.ts` and validated with `pnpm --filter @dowhat/shared test -- taxonomy`.
- Added the web onboarding `SportSelector` (`apps/doWhat-web/src/components/onboarding/SportSelector.tsx`) backed by the shared sports taxonomy, Supabase profile + `user_sport_profiles` upserts, and RTL coverage in `src/components/onboarding/__tests__/SportSelector.test.tsx`; verified via `pnpm --filter dowhat-web test -- SportSelector`.
- Noted the integration plan: render `SportSelector` on a new `/onboarding/sports` route plus a profile-callout card, gate saves behind auth, and extend Playwright onboarding specs once the page exists; future tests will mount the hosting page and reuse the component’s mocked Supabase helpers.
- Landed the Expo onboarding screen at `apps/doWhat-mobile/src/app/onboarding/sports.tsx`, mirroring the shared taxonomy + Supabase upsert flow and routing successful saves to `/onboarding/reliability-pledge`; re-ran `pnpm --filter doWhat-mobile run typecheck` to keep the mobile bundle healthy.
- Added the web `/onboarding/sports` page that reuses `SportSelector`, enforces auth, and communicates the sport/skill benefits so the onboarding flow mirrors the mobile experience.
- Surfaced a `SportOnboardingBanner` on the profile page which detects missing `primary_sport` data, nudges users to finish onboarding, and links to the new page; state hydrates from Supabase so the CTA disappears once preferences exist.
- Created RTL coverage for the banner (`src/components/profile/__tests__/SportOnboardingBanner.test.tsx`) and re-ran `pnpm --filter dowhat-web test -- SportOnboardingBanner` plus the repo-wide `pnpm -w run typecheck` to ensure the new route/components compile everywhere.
- Added `packages/shared/src/recommendations/rankSessions.ts` with distance/skill/urgency scoring, covered it via `src/recommendations/__tests__/rankSessions.test.ts`, re-exported the helper from `packages/shared/src/index.ts`, and verified with `pnpm --filter shared test -- rankSessions`.
- Extended `/admin/new` with a feature-flagged “Looking for players” section that captures slots + skill focus, validates counts, inserts into `session_open_slots` (rolling back the session if the insert fails), and added RTL coverage (`apps/doWhat-web/src/app/admin/new/__tests__/page.test.tsx`) to guard the new toggle/reset behavior; green via `pnpm --filter dowhat-web test -- admin/new`.

## 2025-12-07
- Added migration `036_attendance_reliability_trigger.sql`, which installs a `reliability_delta_for_status` helper plus an `AFTER INSERT OR UPDATE` trigger on `session_attendees` so Postgres clamps and writes `profiles.reliability_score` without relying on an Edge worker.
- Simplified the host attendance API to trust the new trigger (no more `EDGE_ATTENDANCE_*` envs), kept the verified checkbox normalization, and replaced the Edge route with a `410 Gone` stub so any lingering clients fail fast during rollout.
- Trimmed `apps/doWhat-web/src/lib/sessions/attendanceReliability.ts` down to the `normalizeVerifiedFlag` helper (with updated Jest coverage) now that status→action mapping lives entirely in SQL.
- Added an `/admin/sessions` Playwright spec (`apps/doWhat-web/tests/e2e/admin-sessions-plan.spec.ts`) that mocks Supabase auth/data, dismisses the geo banner, and verifies the “Plan another” link encodes activity, venue, taxonomy, coordinate, price, and schedule parameters before launching `/admin/new`.
- Updated the `/admin/sessions` page to honor the `NEXT_PUBLIC_E2E_ADMIN_BYPASS` + `?e2e=1` combo so automation can reach the manage table without depending on the real allowlist while keeping production behavior unchanged.
- Added an `/admin` dashboard Playwright spec (`apps/doWhat-web/tests/e2e/admin-dashboard-plan.spec.ts`) that seeds Supabase auth, stubs venues/sessions/profile counts, and asserts the overview table’s “Plan another” CTA emits the full clone query (activity, venue, taxonomy, coordinates, price, schedule, source).
- Updated the admin dashboard page to respect the same `NEXT_PUBLIC_E2E_ADMIN_BYPASS` flag so test runs can skip the allowlist gate while real admins still rely on the configured email list.
- Added an `/admin/venues` Playwright flow (`apps/doWhat-web/tests/e2e/admin-venues-manage.spec.ts`) that seeds auth, mocks Supabase venue/search/save endpoints, dismisses the geofence banner, confirms the venues table renders Save toggles, verifies the inline “Add venue” form, exercises the search empty state, and deletes a venue row end-to-end via the mocked REST API.
- Documented the Supabase migration plan for files 025–031 by archiving the old `database_updates.sql`, replacing it with a runbook that points to `run_migrations.js`, adding `docs/migrations_025-031_validation.md`, and updating `package.json`’s `db:migrate` script so every environment replays the numbered migrations instead of bespoke SQL.

## 2025-12-06
- Extended Step 6 monitoring work: the `/api/cleanup` route now enforces the admin allowlist and records every batch delete in `admin_audit_logs`, and a new export endpoint (`apps/doWhat-web/src/app/api/admin/audit-logs/route.ts`) serves JSON or CSV downloads that the `/admin` dashboard links to via a “Download CSV” control.
- Delivered Step 6 monitoring upgrades: added Supabase migration `034_admin_audit_logs.sql` to create `admin_allowlist` + `admin_audit_logs` with RLS, wired the `/admin` dashboard with search input, growth highlight cards, and a live audit log table, and prompt admins for optional deletion reasons before logging session/venue deletes.
- Added the first Playwright smoke suite so `npx playwright test --project=chromium` now spins up the Next dev server and pings `/api/health`; config lives at `playwright.config.ts` and the spec (`apps/doWhat-web/tests/e2e/health.spec.ts`) asserts the health response shape without depending on seeded Supabase data.
- Added an admin gate Playwright spec (`apps/doWhat-web/tests/e2e/admin-gate.spec.ts`) to ensure `/admin`, `/admin/sessions`, and `/admin/new` continue to block anonymous visitors, aligning with Roadmap Step 4’s host-tooling guardrails.
- Added RTL coverage for the venue verification page (`apps/doWhat-web/src/app/venues/__tests__/page.test.tsx`) backed by `@testing-library/user-event`; the suite exercises the status filter chips plus the Save/plan CTA wiring so the new shared taxonomy/save helpers stay regression-safe.
- Extended the same venue verification RTL suite to cover vote success + auth-error flows, ensuring the `/api/vote-activity` handler updates list counts, renders success copy, and surfaces sign-in prompts when Supabase rejects anonymous votes.
- Added another RTL scenario for the venue verification detail drawer so selecting a new venue updates the drawer heading, the `/admin/new` plan link (with encoded venue metadata), and the Save toggle payload, keeping the host-facing drawer UI regression-safe.
- `/admin/new` now lists coordinates in the prefill summary even when clone links only supply one of latitude/longitude, showing a placeholder for the missing value and keeping ops aware of partial data; the RTL suite (`apps/doWhat-web/src/app/admin/new/__tests__/page.test.tsx`) covers the new summary row.
- Surfaced taxonomy badges inside the map popup so the saved-activity experience mirrors the shared presets: a new helper (`apps/doWhat-web/src/lib/activityCategoryLabels.ts`) normalizes tier3 ids (covered by `src/lib/__tests__/activityCategoryLabels.test.ts`), and `WebMap.tsx` now renders the canonical labels for each selected activity.
- Extracted the venue verification taxonomy plumbing into `apps/doWhat-web/src/lib/venues/taxonomySupport.ts` and added focused tests (`src/lib/venues/__tests__/taxonomySupport.test.ts`) so the shared tier3 filtering stays aligned with ACTIVITY_NAMES while we iterate on the host map tooling.
- Moved the venue Save payload builder out of the page component and into `apps/doWhat-web/src/lib/venues/savePayload.ts`, covering it with `src/lib/venues/__tests__/savePayload.test.ts` so venue verification Save toggles always emit the shared metadata expected by Saved Activities.

## 2025-12-05
- Added a venue safety warning on `/admin/new`: when clone links omit the venue address or coordinates we now surface an amber banner reminding ops to confirm the location before publishing; extended the RTL suite (`page.test.tsx`) to cover the new warnings and partial-coordinate handling.
- `/admin/new` now renders the venue summary row even when only a `venueAddress` is supplied and treats address/coordinate-only prefills as "venue context" so the amber warning banner still appears; added RTL coverage for both the address-only summary and the coordinate-only warning path.
- Extended the `/admin/sessions` table so every row now exposes a "Plan another" link powered by `buildSessionCloneQuery`, reusing the session’s activity, taxonomy, price, venue address, and coordinates when ops need to spin up a follow-on listing without jumping back to the main dashboard.
- Added RTL coverage for `/admin/sessions` so the new "Plan another" links stay regression-safe and unauthorized admins remain locked out; the suite mocks Supabase rows to ensure the clone helper receives the full venue address + coordinate metadata.
- Added a matching RTL suite for the main `/admin` dashboard so its "Plan another" links keep piping venue address/coordinate metadata into `buildSessionCloneQuery`, and to ensure the allowlist gate still blocks non-admins on the overview page.
- Extended the host venue verification deep-links so `/admin/new` receives structured context:
  - `apps/doWhat-web/src/app/venues/page.tsx` now passes the active taxonomy tier3 id + a `source` tag through every "Plan an event" link, points both CTA buttons at `/admin/new`, and surfaces contextual helper copy/tooltips so hosts know which filters/coordinates will be prefilled.
  - Added `buildPrefillContextSummary` so both the list items and the detail drawer reuse the same description + aria-label text, keeping the new accessibility hints consistent.
- Extracted and expanded the admin prefill helpers:
  - Introduced `apps/doWhat-web/src/lib/adminPrefill.ts` with reusable helpers for building create-event query params, normalising taxonomy IDs (including multi-select support), and generating accessible summaries.
  - `apps/doWhat-web/src/app/venues/page.tsx` now imports the shared helpers so it can emit both `categoryId` + `categoryIds` parameters for future multi-preset links.
  - `/admin/new` parses the `categoryIds` list, hydrates all taxonomy chips, shows every preset in the banner + summary card, and keeps the reset button clearing all hydrated categories.
- Added Jest coverage for the new helpers via `apps/doWhat-web/src/lib/__tests__/adminPrefill.test.ts`, covering query param generation, context summaries, and taxonomy normalisation edge cases.
- Added RTL coverage for `/admin/new` via `apps/doWhat-web/src/app/admin/new/__tests__/page.test.tsx`, exercising the prefill banner/summary rendering (multi-category clones) and ensuring the "Clear prefills" control resets every hydrated field back to the default schedule.
- `/admin/new` now reads `venueAddress` from query prefills (surfaced by venue verification + the new session clone links) and includes it inside the summary list so ops see the exact location context before publishing; the RTL suite asserts the new venue line.
- Upgraded `/admin/new` to hydrate and explain taxonomy prefills:
  - The prefill parser now understands `categoryId` + `source`, seeds `TaxonomyCategoryPicker` selections, and displays a status banner with source attribution + accessible announcements.
  - Added a prefill summary card (activity, venue, coordinates, taxonomy, price/schedule) plus a "Clear prefills" control that resets all fields/schedule/coordinates to defaults.
  - Documented the new helpers with better aria-label/title text so screen readers hear when prefills are present or cleared.
- Centralized the activity filter knobs so both clients import the same presets/helpers:
  - Added `packages/shared/src/preferences/activityFilterOptions.ts` (re-exported via `src/index.ts`) with shared price/distance/time option metadata, default radius/price constants, canonical time-of-day helpers, and resolver utilities for mapping UI keys ⇄ stored ranges/values.
  - Ensures future analytics/reporting only need to reason about one set of filter constants instead of drifting per-surface copies.
- Rebased the Activity Filter screens on the shared module:
  - `apps/doWhat-mobile/src/app/filter.tsx` now imports the shared presets, uses the resolver helpers to hydrate/persist Supabase-backed preferences, and keeps the “free only” toggle + taxonomy picker behavior intact.
  - `apps/doWhat-web/src/app/filter/page.tsx` now drives radius/price/time controls off the same data, adds reusable price pills, canonicalizes stored time-of-day values (covering legacy `morning` IDs), and renders summary chips with the shared metadata.
- Extended the People Filter parity work:
  - Added `packages/shared/src/preferences/peopleFilterOptions.ts` so both clients reference the same skill level/age range/group size strings.
  - `apps/doWhat-mobile/src/app/people-filter.tsx` now consumes the shared arrays, keeping Supabase & UI copy in sync with web.
  - `apps/doWhat-web/src/app/people-filter/page.tsx` now reuses the shared taxonomy picker, time-of-day presets, distance/price helpers, and people filter arrays, plus canonicalizes stored time-of-day values before persisting to Supabase/local storage.
- Rebuilt the Admin Dashboard filters so host tooling uses the shared taxonomy/time presets:
  - `apps/doWhat-web/src/app/admin/page.tsx` now includes a `TaxonomyCategoryPicker` + shared time-of-day pills, filters session lists/top categories against those selections, and maps Supabase activity types to canonical tier1+tier3 labels via the shared taxonomy index.
  - Keeps ops workflows aligned with the consumer Activity Filter while preserving delete/edit actions.
- Extended the admin session creation flow so host tooling tags new activities with the shared taxonomy:
  - `apps/doWhat-web/src/app/admin/new/page.tsx` now embeds the `TaxonomyCategoryPicker`, hydrates selections when admins pick an existing activity, and persists the chosen tier3 ids back to Supabase for both new inserts and edits.
  - Keeps Save/discovery filters aligned by ensuring every activity created via `/admin/new` carries the same `activity_types` metadata as consumer-facing surfaces.
- Brought the host venue verification map onto the shared taxonomy + distance presets:
  - `apps/doWhat-web/src/app/venues/page.tsx` now exposes the shared `TaxonomyCategoryPicker` (filtered down to supported activities) and reuses the Activity Filter distance pills so hosts review AI suggestions with the same knobs as consumers.
  - Keeps analytics aligned by mapping taxonomy selections back to the legacy `ACTIVITY_NAMES` enum before fetching venues, while surfacing the shared UI affordances in the verification workflow.
- Polished the `/admin/new` flow with query-prefill + validation helpers:
  - Added URL param hydration (activity/venue IDs, coordinates, schedule, price) plus coordinate validation hints so ops can jump from host tooling links straight into a ready-to-save draft.
  - Coordinates now warn on partial/invalid values, defaults auto-populate the schedule window, and we show a prefill banner reminding admins to confirm taxonomy tags before publishing.
- Verified via `pnpm -w run typecheck`.
- Added regression coverage for the shared Save payload adapters:
  - `apps/doWhat-web/src/components/__tests__/ActivityCard.test.tsx` now ensures the card feeds its Save toggle via `buildActivitySavePayload` (with venue + primary session metadata), and `ActivityScheduleBoard.test.tsx` verifies the session-level builder wiring.
  - `apps/doWhat-web/src/lib/__tests__/savePayloads.test.ts` checks that the venue helper decorates the shared builder with map-specific metadata, and `jest.config.js` now maps `@dowhat/shared` to the monorepo source so these suites can resolve the shared helpers.
- Verified via `pnpm --filter dowhat-web test -- ActivityCard ActivityScheduleBoard savePayloads`.
- Expanded the Saved Activities provider coverage:
  - `apps/doWhat-web/src/contexts/__tests__/SavedActivitiesContext.test.tsx` now includes inline snapshots for the hydrated state plus a refresh-without-auth scenario, ensuring the provider clears items/error when users sign out.
  - Added a serialiser helper so future shape changes break the snapshot, and wrapped the auth state change in `act()` to mirror real lifecycle updates.
- Verified via `pnpm --filter dowhat-web test -- SavedActivitiesContext`.
- Reworked the web Activity Filters surface to consume the shared taxonomy:
  - `apps/doWhat-web/src/app/filter/page.tsx` now renders the shared `TaxonomyCategoryPicker` backed by `activityTaxonomy`/`defaultTier3Index`, so filter chips display the canonical tier1+tier3 labels instead of a bespoke list.
  - Tightened the Supabase auth mock typing in `SavedActivitiesContext.test.tsx` to reflect the real callback signature, keeping the suite type-safe after the new snapshot assertions.
- Verified via `pnpm --filter dowhat-web run typecheck`.
- Updated `ENGINEERING_ROADMAP_2025.md` Step 4 again to mark those regression tests as complete and call out the next focus (SavedActivitiesContext snapshot coverage + gating these suites in CI).
- Updated `ENGINEERING_ROADMAP_2025.md` Step 4 once more to reflect that the SavedActivitiesContext coverage is landed and the suites now run inside `pnpm -w run test`, setting the next focus on aligning taxonomy/filter constants and finishing the host-tooling parity audit.
- Updated `ENGINEERING_ROADMAP_2025.md` Step 4 to record that Saved Activities parity is complete (mobile/web/admin/venues now share the `@dowhat/shared` payload builders) and to call out the next follow-up tests we need on ActivityCard, ActivityScheduleBoard, the venue helper, and the SavedActivitiesContext snapshots.
- Finished the reliability migration to `session_attendees`: `apps/doWhat-web/src/lib/reliabilityAggregate.ts` now sources participation records and the active-user scan solely from the canonical attendance tables (dropping the legacy `event_participants` fallback) so future recomputes and analytics ignore stale RSVP data.
- Removed the `event_participants` fallback from the reviews API: `apps/doWhat-web/src/app/api/reviews/route.ts` now requires events to expose a `source_session_id` and only authorizes reviewers who appear in `session_attendees`, returning `session_not_migrated` if the session link is missing so legacy RSVP rows can no longer bypass the new attendance model.
- Dropped the final RSVP-era schema remnants by adding `apps/doWhat-web/supabase/migrations/033_remove_event_participants.sql`, which deletes `public.event_participants` and the `public.rsvp_status` enum now that every client/API runs exclusively on `session_attendees`; `docs/current_app_overview_2025-12-03.md` now captures the cleanup.
- Added regression coverage for the web trait onboarding wrapper: `apps/doWhat-web/src/components/traits/__tests__/TraitOnboardingSection.test.tsx` now verifies that completing the selector pushes admins to the default profile redirect or any custom path, ensuring Step 3 onboarding work stays stable.
- Delivered Save toggle parity on mobile session detail: `apps/doWhat-mobile/src/app/(tabs)/sessions/[id].tsx` now wires in `useSavedActivities`, builds a metadata-rich `SavePayload`, and surfaces a contextual Save/Saved button so the detail screen matches the web experience.
- Added the Save toggle to the mobile Home feed’s “Popular nearby places” carousel: `apps/doWhat-mobile/src/app/home.tsx` now imports `useSavedActivities`, builds place payloads (including metadata-derived venue ids), and renders a pill button on each card so people can bookmark venues before jumping into the map.
- Extended Saved toggle parity to the Home “Nearby Activities” grid: cards now derive a `SavePayload` from the linked session rows (plus graceful fallbacks for ad-hoc IDs) and render a Save/Saved control with optimistic pending states so browsing the grid mirrors the web discovery experience.
- Added the Save toggle to the Home “Upcoming Sessions” list: each card now builds a metadata-rich session payload (activity id/name, schedule, price, venue) and surfaces the shared Save/Saved pill with optimistic pending states, so bookmarking upcoming events matches the rest of the home feed parity work.
- Refreshed the mobile Saved tab to consume the shared Saved Activities provider: the screen now mirrors context state, supports pull-to-refresh, and exposes the same Save/Saved pill so people can unsave items inline without drilling into detail pages.
- Hoisted the place/activity/session Save payload builders into `packages/shared/src/savedActivities/index.ts`, so both clients reuse the same metadata normalization when rendering Save/Saved pills (home feeds, map surfaces, saved tab, etc.).
- Rebased the mobile map sheet Save button on the shared `buildPlaceSavePayload`, keeping the venue/address overrides but relying on the canonical helper so map saves mirror the rest of the Step 2 parity work.
- Pointed the web `buildPlaceSavePayload` helper at the shared version (while layering in map-specific metadata) so every Places map Save toggle now benefits from the canonical venue/address handling introduced for mobile.
- Rebased the mobile Session Detail Save button on the shared `buildSessionSavePayload`, so the metadata (schedule, price, venue names) now flows through the same helper used on the Home screen and future analytics only have one code path to reason about.
- Rebased the web Session Detail Save button on `buildSessionSavePayload` too, mapping the hydrated session rows into the shared helper and layering in host/visibility metadata so both clients emit identical session save telemetry.
- Extended Save toggle parity to the mobile activity detail page: `apps/doWhat-mobile/src/app/(tabs)/activities/[id].tsx` now imports `useSavedActivities`, derives a primary-session `SavePayload`, and renders the shared Save/Saved pill (with optimistic feedback) near the hero so browsing an activity catalog offers the same bookmarking flow as the web.
- Rewired the web Activity Detail page to call `buildActivitySavePayload`, passing its fetched session list into the shared helper and then reapplying the hero’s venue metadata so activity saves are normalized across clients.
- Updated the web Admin Activities/Sessions/Venues dashboards to invoke the shared Save payload builders (`buildActivitySavePayload`, `buildSessionSavePayload`, `buildPlaceSavePayload`) so even ops tooling emits canonical metadata (with admin-specific source tags).
- Deleted the bespoke `buildActivityDetailSavePayload` helper (and the unused map helper file) now that every surface leans on the shared builders, preventing future divergence between consumer UI and admin dashboards.
- Activity discovery components (`ActivityCard` and `ActivityScheduleBoard`) now build their Save payloads via the shared helpers, ensuring the home grid and schedule board emit the same activity/session metadata as mobile.
- Venue verification lists/detail drawers now derive Save payloads from `buildPlaceSavePayload`, layering AI confidence + verification metadata so every map/list surface reuses the same canonical place normalization.
- Added a trait onboarding CTA to the mobile Profile screen: `apps/doWhat-mobile/src/app/profile.simple.tsx` fetches the `user_base_traits` count, surfaces a "Finish onboarding" banner when people have fewer than five base vibes, and deep-links to `/onboarding-traits` so the main profile matches the new web nudges.
- Added a trait onboarding CTA to the mobile People Filter: `apps/doWhat-mobile/src/app/people-filter.tsx` now counts `user_base_traits` rows and surfaces a banner that nudges anyone with fewer than five traits over to `/onboarding-traits`, keeping the personalization hints honest on iOS/Android too.
- Added Jest coverage for the new profile + people-filter trait nudges: `apps/doWhat-web/src/app/profile/__tests__/page.test.tsx` mocks Supabase auth + profile fetches, switches to the Traits tab, and proves the banner persists until five base traits exist, while `apps/doWhat-web/src/app/people-filter/__tests__/page.test.tsx` stubs `user_base_traits` counts plus the popular-traits API so the Smart Filters CTA stays regression-safe.
- Hardened the web Session Attendance quick actions coverage:
  - Added a third mocked fetch response inside `apps/doWhat-web/src/components/__tests__/SessionAttendanceQuickActions.test.tsx` so the post-mutation realtime refresh has data to consume, eliminating the console warning seen during Jest runs.
  - Re-ran `pnpm --filter dowhat-web test -- SessionAttendanceQuickActions` to ensure the suite stays green after the mock update.
- Finished moving the "My Attendance" area off the RSVP naming and route:
  - Relocated the client page/loading skeleton to `apps/doWhat-web/src/app/my/attendance/` and renamed the component to `MyAttendancePage` so the URL and code now match the new terminology.
  - Left a lightweight redirect in `apps/doWhat-web/src/app/my/rsvps/page.tsx` plus re-exported the loading state to keep old bookmarks working while nudging traffic to `/my/attendance`.
  - Updated the `SessionAttendanceList` warning to say "attendance update" instead of "RSVP" to squash the last visible RSVP wording in the attendee widgets.
- Added dedicated Jest coverage for the web Saved Activities provider:
  - Auth + Supabase interactions inside `apps/doWhat-web/src/contexts/SavedActivitiesContext.tsx` are now exercised via `src/contexts/__tests__/SavedActivitiesContext.test.tsx`, mirroring the mobile suite.
  - Scenarios cover initial loads, optimistic saves, legacy fallback writes, and toggle-based unsaves; validated with `pnpm --filter dowhat-web test -- SavedActivitiesContext`.
- Finished scrubbing the legacy `My RSVPs` path:
  - Deleted the `/my/rsvps` route files now that `/my/attendance` hosts the full experience and added a permanent redirect in `apps/doWhat-web/next.config.mjs` so old bookmarks jump to the new slug without exposing RSVP-era wording.
- Synced documentation with the latest attendance work:
  - Updated `docs/current_app_overview_2025-12-03.md` to explicitly call out that web session detail now runs entirely on `session_attendees`.
  - Noted in `docs/main_commit_0ae969c_overview.md` that the feature branch completes the RSVP→attendance migration so readers comparing snapshots understand the delta.
- Deleted the unused `RsvpBadges`, `RsvpBox`, and `RsvpQuickActions` alias files now that every surface imports the `SessionAttendance*` components directly, removing the last legacy exports from `apps/doWhat-web/src/components/`.
- Added Jest coverage for the shared `SaveToggleButton` UI so Saved Activities parity work stays regression-safe — tests live in `apps/doWhat-web/src/components/__tests__/SaveToggleButton.test.tsx` and verify null payload handling, saved/unsaved states, and pending toggles via mocked `useSavedActivities`; run with `pnpm --filter dowhat-web test -- SaveToggleButton`.
- Rounded out the attendance UI coverage by adding `apps/doWhat-web/src/components/__tests__/SessionAttendanceBadges.test.tsx`, exercising empty-session rendering, fetch/load wiring, and the realtime refresh path triggered by the `session-attendance-updated` event; verified via `pnpm --filter dowhat-web test -- SessionAttendanceBadges`.
- Added Jest coverage for `/my/attendance`: `apps/doWhat-web/src/app/my/attendance/__tests__/page.test.tsx` now spies on the Supabase browser client to cover unauthenticated gates, hydrated session lists, optimistic status toggles, query failures, and mutation errors; verified with `pnpm --filter dowhat-web test -- my/attendance`.
- Extended `apps/doWhat-web/src/contexts/__tests__/SavedActivitiesContext.test.tsx` with per-table select errors plus a fallback-read test so the provider proves it advances through `READ_SOURCES` when Supabase views vanish and reprioritizes legacy write targets; green via `pnpm --filter dowhat-web test -- SavedActivitiesContext`.
- Mirrored the fallback-read coverage on mobile: `apps/doWhat-mobile/src/contexts/__tests__/SavedActivitiesContext.test.tsx` now injects per-table select errors and asserts the provider hydrates from `saved_activities_view` + prefers legacy write targets when the primary view disappears; verified with `pnpm --filter doWhat-mobile test -- SavedActivitiesContext`.
- Added a dedicated web onboarding surface at `/onboarding/traits` that checks Supabase auth, explains the Step 3 checklist, and embeds the shared `TraitSelector` via the new `TraitOnboardingSection` client wrapper so users land back on `/profile` after saving their five base vibes; captured the route in `docs/current_app_overview_2025-12-03.md`.
- Wired the `/profile` traits tab with a CTA card that detects incomplete stacks (fewer than five traits) and links directly to `/onboarding/traits`, so members discover the new onboarding flow without leaving their profile edit screen; documented the banner in `docs/current_app_overview_2025-12-03.md`.
- Added the same onboarding CTA to the `/people-filter` page so anyone missing base traits is prompted to finish the five-trait stack before dialing in preferences, keeping personalization hints honest; captured the change in `docs/current_app_overview_2025-12-03.md`.
- Added Jest coverage for `/app/onboarding/traits/page.tsx`, mocking Supabase auth + `next/navigation.redirect`, dynamically importing the server component under test, and stubbing `TraitOnboardingSection` so we prove unauthenticated visitors get bounced to `/auth/login` while signed-in users see the Step 3 checklist; the suite runs via `pnpm --filter dowhat-web test -- onboarding/traits` and now passes with the new redirect mock defined in `src/setupTests.ts`.
- Added Jest coverage for the `TraitVoteDialog` so post-session vibes stay regression-safe — the suite at `apps/doWhat-web/src/components/traits/__tests__/TraitVoteDialog.test.tsx` exercises catalog loading, multi-participant selections, clear-all handling, and empty rosters; green via `pnpm --filter dowhat-web test -- TraitVoteDialog`.
- Added RN Jest coverage for the mobile trait onboarding nudges: `apps/doWhat-mobile/src/app/__tests__/profile.simple.cta.test.tsx` and `people-filter.test.tsx` now stub Supabase auth/count queries, mock `fetch` for the popular traits call, and assert the “Finish onboarding” banners only render below the five-trait threshold; warning noise from React Native Animated is suppressed via a scoped console spy so the suites run cleanly (`pnpm --filter doWhat-mobile test -- profile.simple.cta people-filter`).
- Extended the Expo trait onboarding screen coverage: `apps/doWhat-mobile/src/app/__tests__/onboarding-traits.test.tsx` now mocks safe-area/router primitives, targets the save button via a dedicated testID, and adds an auth-regression case so the five-trait cap, successful save flow (including Supabase RPC fan-out), and the "Please sign in again" error path stay guarded. Verified with `pnpm --filter doWhat-mobile test -- onboarding-traits`.
- Linked the Step 3 validation plan to the new test by updating `docs/trait_policies_test_plan.md` so the onboarding checklist explicitly references `apps/doWhat-mobile/src/app/__tests__/onboarding-traits.test.tsx` when describing the mocked mobile flow check.

## 2025-12-04
- Updated `apps/doWhat-web/src/app/api/profile/[id]/kpis/route.ts` to source its metrics from `sessions` + `session_attendees`, renaming the KPIs to "Sessions Hosted / Sessions Going / Attendance Updates" so profile stats reflect the new attendance model.
- Pointed the related profile activity timeline at the same data by moving `apps/doWhat-web/src/app/api/profile/[id]/activities/route.ts` over to `session_attendees` (pulling session start times + activity names for nicer labels) and leaving the old event participant read behind.
- Tightened the reviews API guardrails via `apps/doWhat-web/src/app/api/reviews/route.ts`: it now validates reviewer eligibility against `session_attendees` whenever an `events.source_session_id` exists, only falling back to the legacy `event_participants` check if no session record is available.
- Rewired the reliability aggregation job (`apps/doWhat-web/src/lib/reliabilityAggregate.ts`) to read participation history from `session_attendees`, derive punctuality heuristics from `checked_in/attended_at`, and only consult `event_participants` as a compatibility fallback; the active-user scanner now prioritizes session attendance activity as well.
- Retired the unused `/api/events/[id]/attendance` handler by returning HTTP 410 along with guidance to use the session attendance API family, preventing any lingering writes to the legacy `event_participants` table.
- Archived the unused `RsvpBox` implementation by turning it into a thin alias of `SessionAttendancePanel`, so no legacy Supabase logic remains even if imports linger in the wild (the other `Rsvp*` files were already pointing to the new components).
- Kicked off Roadmap Step 2 (Saved Activities parity):
  - Extracted the Saved Activities helper types/data sources into `packages/shared/src/savedActivities` and refactored the mobile context to use the shared utilities.
  - Added a web `SavedActivitiesProvider` (`apps/doWhat-web/src/contexts/SavedActivitiesContext.tsx`) and wired it through `src/app/providers.tsx` so both platforms share the same save/unsave logic foundation.
  - Added a reusable `SaveToggleButton` client component plus wired it into `apps/doWhat-web/src/components/ActivityCard.tsx` and `ActivityScheduleBoard.tsx`, giving discovery cards and activity detail schedules the same optimistic Save/Saved control backed by the shared context.
- Extended the Save toggle coverage to the venue verification page (`apps/doWhat-web/src/app/venues/page.tsx`):
  - Added a helper to normalize `RankedVenueActivity` rows into `SavePayload`s (including metadata about the activity + AI confidence) so every venue list item can trigger the shared save/unsave flow.
  - Injected the reusable `SaveToggleButton` into each venue card and the detail drawer, stopping event propagation so clicks don’t change the active selection while saves happen optimistically.
- Wired the `/map` activity list into the shared Saved Activities flow:
  - Import the shared `SaveToggleButton` on `apps/doWhat-web/src/app/map/page.tsx`, derive `SavePayload`s from `MapActivity` rows (distance, tags, traits metadata), and show the toggle alongside each nearby activity without breaking card selection.
  - Ensures the map list is now consistent with discovery cards, schedules, and the venue verification UI for Roadmap Step 2 parity.
- Shared the map save payload helper and covered the map popup surface:
  - Moved the payload builder into `apps/doWhat-web/src/lib/map/savePayload.ts` so both the list and the map component reuse the same metadata wiring.
  - Added `SaveToggleButton` to the Mapbox popup in `apps/doWhat-web/src/components/WebMap.tsx`, letting people save/unsave directly from the on-map detail card.
- Introduced `apps/doWhat-web/src/lib/savePayloads.ts` plus wired the activity detail page into the Saved Activities flow:
  - Centralized the map helper and added a new `buildActivityDetailSavePayload` so server pages can emit consistent metadata.
  - Updated `apps/doWhat-web/src/app/activities/[id]/page.tsx` to surface a Save toggle beside the hero (using the first upcoming session/venue), and expanded the sessions query to fetch `venue_id`/addresses for richer payload context.
- Advanced Roadmap Step 3 (traits onboarding & personalization hints):
  - Added `/api/traits/popular` to aggregate `user_trait_summary` rows into ranked hint cards that expose total score/base/vote counts per trait.
  - Rewired the mobile (`apps/doWhat-mobile/src/app/people-filter.tsx`) and web (`apps/doWhat-web/src/app/people-filter/page.tsx`) People Filter screens to fetch those hints (with emoji/icon fallbacks) so the “Popular Personality Traits Nearby” module now reflects actual Supabase data instead of static seeds.
  - Updated `scripts/verify-trait-policies.mjs` to seed `session_attendees` instead of the deprecated `rsvps` table, keeping the Step 3 validation script aligned with the session attendance migration.
  - Synced the same script with the latest `sessions` schema (`host_user_id`, `max_attendees`, explicit visibility) so it can spin up disposable sessions without tripping column mismatches; `node --check scripts/verify-trait-policies.mjs` succeeds locally even though a full Supabase run still needs valid env keys.

## 2025-12-03
- Completed Step 1 of the session attendance migration on web:
  - Added the `/api/sessions/[sessionId]/attendance` GET route plus shared helpers to expose counts and per-user status from `session_attendees`.
  - Replaced `RsvpQuickActions`/`RsvpBadges` with `SessionAttendanceQuickActions` and `SessionAttendanceBadges`, wiring Activity cards, schedules, and the Nearby page to the new API.
  - Removed the legacy `session-rsvp-updated` event fallback so all UI listens to the unified `session-attendance-updated` signal.
- Updated `apps/doWhat-mobile/src/app/(tabs)/map/index.tsx` to better understand Supabase-linked venues:
  - Expanded `PlaceMetadata` typing and added helpers (`normaliseStringId`, `extractVenueIdFromMetadata`, `resolveVenueIdForSaving`) so the map can discover canonical venue ids embedded in metadata.
  - Track the active venue’s session counts via `v_venue_attendance_summary`, including new loading state management.
  - Added save/unsave button logic in the place detail sheet (leveraging `SavedActivitiesContext`) with optimistic UI feedback and error alerts.
  - Surfaced upcoming/total session messaging inside the detail card and introduced associated styles.
- Introduced an admin-only dashboard at `apps/doWhat-web/src/app/admin/page.tsx`:
  - Gate access via `NEXT_PUBLIC_ADMIN_EMAILS` and reuse the Supabase browser client for auth & data fetching.
  - Surface analytics cards (user/session/venue counts + top categories) plus refresh controls.
  - Render full session & venue listings with inline delete actions so inappropriate content can be removed quickly.
- Fixed the Saved Activities context type errors blocking CI (`apps/doWhat-mobile/src/contexts/SavedActivitiesContext.tsx`):
  - Added safe helpers to coerce Supabase rows into plain records and pick trimmed string fields.
  - Eliminated `as Record<string, unknown>` casts so `pnpm -w run typecheck` now passes across packages again.
- Authored `ENGINEERING_ROADMAP_2025.md` to capture the next engineering milestones (session_attendees migration, SavedActivities fixes, trait onboarding, cross-platform parity, migrations hygiene, admin monitoring, and ongoing documentation updates).
